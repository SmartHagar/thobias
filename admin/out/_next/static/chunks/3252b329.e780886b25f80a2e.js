"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3909],{2915:function(e,t,l){l.d(t,{fj:function(){return ey},iA:function(){return e_},rY:function(){return ez}});var n=l(8937),i=l(7514),o=l(2171),r=l(9273),s=l(258),a=l(177);l(7632),l(2416);var d=l(1561),u=l(3550);function c(e,t,l,n,i=1){null!=t&&null!=i&&t>i?n.setAttribute(e,t,l):n.removeAttribute(e,l)}function m(e,t,l={}){let n=e.createElement("tableCell",l);return e.insertElement("paragraph",n),e.insert(n,t),n}function h(e,t){let l=parseInt(t.parent.parent.getAttribute("headingColumns")||"0"),{column:n}=e.getCellLocation(t);return!!l&&n<l}function g(e){return t=>{t.on(`element:${e}`,(e,t,{writer:l})=>{if(!t.modelRange)return;let n=t.modelRange.start.nodeAfter,i=l.createPositionAt(n,0);if(t.viewItem.isEmpty){l.insertElement("paragraph",i);return}let o=Array.from(n.getChildren());if(o.every(e=>e.is("element","$marker"))){let e=l.createElement("paragraph");for(let t of(l.insert(e,l.createPositionAt(n,0)),o))l.move(l.createRangeOn(t),l.createPositionAt(e,"end"))}},{priority:"low"})}}class f{_table;_startRow;_endRow;_startColumn;_endColumn;_includeAllSlots;_skipRows;_row;_rowIndex;_column;_cellIndex;_spannedCells;_nextCellAtColumn;_jumpedToStartRow=!1;constructor(e,t={}){this._table=e,this._startRow=void 0!==t.row?t.row:t.startRow||0,this._endRow=void 0!==t.row?t.row:t.endRow,this._startColumn=void 0!==t.column?t.column:t.startColumn||0,this._endColumn=void 0!==t.column?t.column:t.endColumn,this._includeAllSlots=!!t.includeAllSlots,this._skipRows=new Set,this._row=0,this._rowIndex=0,this._column=0,this._cellIndex=0,this._spannedCells=new Map,this._nextCellAtColumn=-1}[Symbol.iterator](){return this}next(){this._canJumpToStartRow()&&this._jumpToNonSpannedRowClosestToStartRow();let e=this._table.getChild(this._rowIndex);if(!e||this._isOverEndRow())return{done:!0,value:void 0};if(!e.is("element","tableRow"))return this._rowIndex++,this.next();if(this._isOverEndColumn())return this._advanceToNextRow();let t=null,l=this._getSpanned();if(l)this._includeAllSlots&&!this._shouldSkipSlot()&&(t=this._formatOutValue(l.cell,l.row,l.column));else{let l=e.getChild(this._cellIndex);if(!l)return this._advanceToNextRow();let n=parseInt(l.getAttribute("colspan")||"1"),i=parseInt(l.getAttribute("rowspan")||"1");(n>1||i>1)&&this._recordSpans(l,i,n),this._shouldSkipSlot()||(t=this._formatOutValue(l)),this._nextCellAtColumn=this._column+n}return this._column++,this._column==this._nextCellAtColumn&&this._cellIndex++,t||this.next()}skipRow(e){this._skipRows.add(e)}_advanceToNextRow(){return this._row++,this._rowIndex++,this._column=0,this._cellIndex=0,this._nextCellAtColumn=-1,this.next()}_isOverEndRow(){return void 0!==this._endRow&&this._row>this._endRow}_isOverEndColumn(){return void 0!==this._endColumn&&this._column>this._endColumn}_formatOutValue(e,t=this._row,l=this._column){return{done:!1,value:new b(this,e,t,l)}}_shouldSkipSlot(){let e=this._skipRows.has(this._row),t=this._row<this._startRow,l=this._column<this._startColumn,n=void 0!==this._endColumn&&this._column>this._endColumn;return e||t||l||n}_getSpanned(){let e=this._spannedCells.get(this._row);return e&&e.get(this._column)||null}_recordSpans(e,t,l){let n={cell:e,row:this._row,column:this._column};for(let e=this._row;e<this._row+t;e++)for(let t=this._column;t<this._column+l;t++)(e!=this._row||t!=this._column)&&this._markSpannedCell(e,t,n)}_markSpannedCell(e,t,l){this._spannedCells.has(e)||this._spannedCells.set(e,new Map),this._spannedCells.get(e).set(t,l)}_canJumpToStartRow(){return!!this._startRow&&this._startRow>0&&!this._jumpedToStartRow}_jumpToNonSpannedRowClosestToStartRow(){let e=this._getRowLength(0);for(let t=this._startRow;!this._jumpedToStartRow;t--)e===this._getRowLength(t)&&(this._row=t,this._rowIndex=t,this._jumpedToStartRow=!0)}_getRowLength(e){return[...this._table.getChild(e).getChildren()].reduce((e,t)=>e+parseInt(t.getAttribute("colspan")||"1"),0)}}class b{cell;row;column;cellAnchorRow;cellAnchorColumn;_cellIndex;_rowIndex;_table;constructor(e,t,l,n){this.cell=t,this.row=e._row,this.column=e._column,this.cellAnchorRow=l,this.cellAnchorColumn=n,this._cellIndex=e._cellIndex,this._rowIndex=e._rowIndex,this._table=e._table}get isAnchor(){return this.row===this.cellAnchorRow&&this.column===this.cellAnchorColumn}get cellWidth(){return parseInt(this.cell.getAttribute("colspan")||"1")}get cellHeight(){return parseInt(this.cell.getAttribute("rowspan")||"1")}get rowIndex(){return this._rowIndex}getPositionBefore(){return this._table.root.document.model.createPositionAt(this._table.getChild(this.row),this._cellIndex)}}function p(e,t){return(l,{writer:n})=>{let o=l.getAttribute("headingRows")||0,r=n.createContainerElement("table",null,[]),s=n.createContainerElement("figure",{class:"table"},r);for(let{positionOffset:i,filter:s}of(o>0&&n.insert(n.createPositionAt(r,"end"),n.createContainerElement("thead",null,n.createSlot(e=>e.is("element","tableRow")&&e.index<o))),o<e.getRows(l)&&n.insert(n.createPositionAt(r,"end"),n.createContainerElement("tbody",null,n.createSlot(e=>e.is("element","tableRow")&&e.index>=o))),t.additionalSlots))n.insert(n.createPositionAt(r,i),n.createSlot(s));return n.insert(n.createPositionAt(r,"after"),n.createSlot(e=>!e.is("element","tableRow")&&!t.additionalSlots.some(({filter:t})=>t(e)))),t.asWidget?(n.setCustomProperty("table",!0,s),(0,i.XC)(s,n,{hasSelectionHandle:!0})):s}}function w(e={}){return(t,{writer:l})=>{let n=t.parent,o=n.parent,r=o.getChildIndex(n),s=new f(o,{row:r}),a=o.getAttribute("headingRows")||0,d=o.getAttribute("headingColumns")||0,u=null;for(let n of s)if(n.cell==t){let t=n.row<a||n.column<d?"th":"td";u=e.asWidget?(0,i.sC)(l.createEditableElement(t),l):l.createContainerElement(t);break}return u}}function C(e={}){return(t,{writer:l})=>{if(!t.parent.is("element","tableCell")||!A(t))return null;if(e.asWidget)return l.createContainerElement("span",{class:"ck-table-bogus-paragraph"});{let e=l.createContainerElement("p");return l.setCustomProperty("dataPipeline:transparentRendering",!0,e),e}}}function A(e){return 1==e.parent.childCount&&!!e.getAttributeKeys().next().done}class v extends n.mY{refresh(){let e=this.editor.model,t=e.document.selection,l=e.schema;this.isEnabled=function(e,t){let l=e.getFirstPosition().parent,n=l===l.root?l:l.parent;return t.checkChild(n,"table")}(t,l)}execute(e={}){let t=this.editor,l=t.model,n=t.plugins.get("TableUtils"),i=t.config.get("table.defaultHeadings.rows"),o=t.config.get("table.defaultHeadings.columns");void 0===e.headingRows&&i&&(e.headingRows=i),void 0===e.headingColumns&&o&&(e.headingColumns=o),l.change(t=>{let i=n.createTable(t,e);l.insertObject(i,null,null,{findOptimalPosition:"auto"}),t.setSelection(t.createPositionAt(i.getNodeByPath([0,0,0]),0))})}}class _ extends n.mY{order;constructor(e,t={}){super(e),this.order=t.order||"below"}refresh(){let e=this.editor.model.document.selection,t=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=t}execute(){let e=this.editor,t=e.model.document.selection,l=e.plugins.get("TableUtils"),n="above"===this.order,i=l.getSelectionAffectedTableCells(t),o=l.getRowIndexes(i),r=n?o.first:o.last,s=i[0].findAncestor("table");l.insertRows(s,{at:n?r:r+1,copyStructureFromAbove:!n})}}class T extends n.mY{order;constructor(e,t={}){super(e),this.order=t.order||"right"}refresh(){let e=this.editor.model.document.selection,t=!!this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e).length;this.isEnabled=t}execute(){let e=this.editor,t=e.model.document.selection,l=e.plugins.get("TableUtils"),n="left"===this.order,i=l.getSelectionAffectedTableCells(t),o=l.getColumnIndexes(i),r=n?o.first:o.last,s=i[0].findAncestor("table");l.insertColumns(s,{columns:1,at:n?r:r+1})}}class R extends n.mY{direction;constructor(e,t={}){super(e),this.direction=t.direction||"horizontally"}refresh(){let e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=1===e.length}execute(){let e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection)[0];"horizontally"===this.direction?e.splitCellHorizontally(t,2):e.splitCellVertically(t,2)}}function S(e,t,l){let{startRow:n,startColumn:i,endRow:o,endColumn:r}=t,s=l.createElement("table"),a=o-n+1;for(let e=0;e<a;e++)l.insertElement("tableRow",s,"end");for(let{row:t,column:a,cell:d,isAnchor:u,cellAnchorRow:c,cellAnchorColumn:h}of[...new f(e,{startRow:n,endRow:o,startColumn:i,endColumn:r,includeAllSlots:!0})]){let e=t-n,g=s.getChild(e);if(u){let e=l.cloneElement(d);l.append(e,g),P(e,t,a,o,r,l)}else(c<n||h<i)&&m(l,l.createPositionAt(g,"end"))}return function(e,t,l,n,i){let o=parseInt(t.getAttribute("headingRows")||"0");o>0&&c("headingRows",o-l,e,i,0);let r=parseInt(t.getAttribute("headingColumns")||"0");r>0&&c("headingColumns",r-n,e,i,0)}(s,e,n,i,l),s}function y(e,t,l=0){let n=[];for(let i of new f(e,{startRow:l,endRow:t-1})){let{row:e,cellHeight:l}=i,o=e+l-1;e<t&&t<=o&&n.push(i)}return n}function x(e,t,l){let n;let i=e.parent,o=i.parent,r=i.index,s=parseInt(e.getAttribute("rowspan")),a=t-r,d={},u=s-a;u>1&&(d.rowspan=u);let h=parseInt(e.getAttribute("colspan")||"1");h>1&&(d.colspan=h);let g=r+a,b=[...new f(o,{startRow:r,endRow:g,includeAllSlots:!0})],p=null;for(let t of b){let{row:i,column:o,cell:r}=t;r===e&&void 0===n&&(n=o),void 0!==n&&n===o&&i===g&&(p=m(l,t.getPositionBefore(),d))}return c("rowspan",a,e,l),p}function E(e,t){let l=[];for(let n of new f(e)){let{column:e,cellWidth:i}=n,o=e+i-1;e<t&&t<=o&&l.push(n)}return l}function I(e,t,l,n){let i=parseInt(e.getAttribute("colspan")),o=l-t,r={},s=i-o;s>1&&(r.colspan=s);let a=parseInt(e.getAttribute("rowspan")||"1");a>1&&(r.rowspan=a);let d=m(n,n.createPositionAfter(e),r);return c("colspan",o,e,n),d}function P(e,t,l,n,i,o){let r=parseInt(e.getAttribute("colspan")||"1"),s=parseInt(e.getAttribute("rowspan")||"1");l+r-1>i&&c("colspan",i-l+1,e,o,1),t+s-1>n&&c("rowspan",n-t+1,e,o,1)}function k(e,t){let l=Array(t.getColumns(e)).fill(0);for(let{column:t}of new f(e))l[t]++;let n=l.reduce((e,t,l)=>t?e:[...e,l],[]);if(n.length>0){let l=n[n.length-1];return t.removeColumns(e,{at:l}),!0}return!1}function z(e,t){let l=[],n=t.getRows(e);for(let t=0;t<n;t++)e.getChild(t).isEmpty&&l.push(t);if(l.length>0){let n=l[l.length-1];return t.removeRows(e,{at:n}),!0}return!1}function M(e,t){k(e,t)||z(e,t)}function D(e,t){let l=Array.from(new f(e,{startColumn:t.firstColumn,endColumn:t.lastColumn,row:t.lastRow}));if(l.every(({cellHeight:e})=>1===e))return t.lastRow;let n=l[0].cellHeight-1;return t.lastRow+n}function V(e,t){let l=Array.from(new f(e,{startRow:t.firstRow,endRow:t.lastRow,column:t.lastColumn}));if(l.every(({cellWidth:e})=>1===e))return t.lastColumn;let n=l[0].cellWidth-1;return t.lastColumn+n}class N extends n.mY{direction;isHorizontal;constructor(e,t){super(e),this.direction=t.direction,this.isHorizontal="right"==this.direction||"left"==this.direction}refresh(){let e=this._getMergeableCell();this.value=e,this.isEnabled=!!e}execute(){let e=this.editor.model,t=e.document,l=this.editor.plugins.get("TableUtils").getTableCellsContainingSelection(t.selection)[0],n=this.value,i=this.direction;e.change(e=>{let t="right"==i||"down"==i,o=t?l:n,r=t?n:l,s=r.parent;O(r)||(O(o)&&e.remove(e.createRangeIn(o)),e.move(e.createRangeIn(r),e.createPositionAt(o,"end"))),e.remove(r);let a=this.isHorizontal?"colspan":"rowspan",d=parseInt(l.getAttribute(a)||"1"),u=parseInt(n.getAttribute(a)||"1");e.setAttribute(a,d+u,o),e.setSelection(e.createRangeIn(o));let c=this.editor.plugins.get("TableUtils");M(s.findAncestor("table"),c)})}_getMergeableCell(){let e=this.editor.model.document,t=this.editor.plugins.get("TableUtils"),l=t.getTableCellsContainingSelection(e.selection)[0];if(!l)return;let n=this.isHorizontal?function(e,t,l){let n=e.parent.parent,i="right"==t?e.nextSibling:e.previousSibling,o=(n.getAttribute("headingColumns")||0)>0;if(!i)return;let r="right"==t?e:i,s="right"==t?i:e,{column:a}=l.getCellLocation(r),{column:d}=l.getCellLocation(s),u=parseInt(r.getAttribute("colspan")||"1"),c=h(l,r),m=h(l,s);if(!o||c==m)return a+u===d?i:void 0}(l,this.direction,t):function(e,t,l){let n=e.parent,i=n.parent,o=i.getChildIndex(n);if("down"==t&&o===l.getRows(i)-1||"up"==t&&0===o)return null;let r=parseInt(e.getAttribute("rowspan")||"1"),s=i.getAttribute("headingRows")||0;if(s&&("down"==t&&o+r===s||"up"==t&&o===s))return null;let a=parseInt(e.getAttribute("rowspan")||"1"),d="down"==t?o+a:o,u=[...new f(i,{endRow:d})],c=u.find(t=>t.cell===e).column,m=u.find(({row:e,cellHeight:l,column:n})=>n===c&&("down"==t?e===d:d===e+l));return m&&m.cell?m.cell:null}(l,this.direction,t);if(!n)return;let i=this.isHorizontal?"rowspan":"colspan",o=parseInt(l.getAttribute(i)||"1");if(parseInt(n.getAttribute(i)||"1")===o)return n}}function O(e){let t=e.getChild(0);return 1==e.childCount&&t.is("element","paragraph")&&t.isEmpty}class H extends n.mY{refresh(){let e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),l=t[0];if(l){let n=l.findAncestor("table"),i=e.getRows(n),o=e.getRowIndexes(t),r=0===o.first&&o.last===i-1;this.isEnabled=!r}else this.isEnabled=!1}execute(){let e=this.editor.model,t=this.editor.plugins.get("TableUtils"),l=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(l),i=l[0],o=i.findAncestor("table"),r=t.getCellLocation(i).column;e.change(e=>{let l=n.last-n.first+1;t.removeRows(o,{at:n.first,rows:l});let i=function(e,t,l,n){let i=e.getChild(Math.min(t,n-1)),o=i.getChild(0),r=0;for(let e of i.getChildren()){if(r>l)break;o=e,r+=parseInt(e.getAttribute("colspan")||"1")}return o}(o,n.first,r,t.getRows(o));e.setSelection(e.createPositionAt(i,0))})}}class W extends n.mY{refresh(){let e=this.editor.plugins.get("TableUtils"),t=e.getSelectionAffectedTableCells(this.editor.model.document.selection),l=t[0];if(l){let n=l.findAncestor("table"),i=e.getColumns(n),{first:o,last:r}=e.getColumnIndexes(t);this.isEnabled=r-o<i-1}else this.isEnabled=!1}execute(){let e=this.editor.plugins.get("TableUtils"),[t,l]=function(e,t){let l=t.getSelectionAffectedTableCells(e),n=l[0],i=l.pop(),o=[n,i];return n.isBefore(i)?o:o.reverse()}(this.editor.model.document.selection,e),n=t.parent.parent,i=[...new f(n)],o={first:i.find(e=>e.cell===t).column,last:i.find(e=>e.cell===l).column},r=parseInt(l.getAttribute("colspan")||"1")>1?l:t.previousSibling||l.nextSibling?l.nextSibling||t.previousSibling:o.first?i.reverse().find(({column:e})=>e<o.first).cell:i.reverse().find(({column:e})=>e>o.last).cell;this.editor.model.change(t=>{let l=o.last-o.first+1;e.removeColumns(n,{at:o.first,columns:l}),t.setSelection(t.createPositionAt(r,0))})}}class F extends n.mY{refresh(){let e=this.editor.plugins.get("TableUtils"),t=this.editor.model,l=e.getSelectionAffectedTableCells(t.document.selection),n=l.length>0;this.isEnabled=n,this.value=n&&l.every(e=>this._isInHeading(e,e.parent.parent))}execute(e={}){if(e.forceValue===this.value)return;let t=this.editor.plugins.get("TableUtils"),l=this.editor.model,n=t.getSelectionAffectedTableCells(l.document.selection),i=n[0].findAncestor("table"),{first:o,last:r}=t.getRowIndexes(n),s=this.value?o:r+1,a=i.getAttribute("headingRows")||0;l.change(e=>{if(s){let t=s>a?a:0;for(let{cell:l}of y(i,s,t))x(l,s,e)}c("headingRows",s,i,e,0)})}_isInHeading(e,t){let l=parseInt(t.getAttribute("headingRows")||"0");return!!l&&e.parent.index<l}}class L extends n.mY{refresh(){let e=this.editor.model,t=this.editor.plugins.get("TableUtils"),l=t.getSelectionAffectedTableCells(e.document.selection),n=l.length>0;this.isEnabled=n,this.value=n&&l.every(e=>h(t,e))}execute(e={}){if(e.forceValue===this.value)return;let t=this.editor.plugins.get("TableUtils"),l=this.editor.model,n=t.getSelectionAffectedTableCells(l.document.selection),i=n[0].findAncestor("table"),{first:o,last:r}=t.getColumnIndexes(n),s=this.value?o:r+1;l.change(e=>{if(s)for(let{cell:t,column:l}of E(i,s))I(t,l,s,e);c("headingColumns",s,i,e,0)})}}function U(e,t){let l=B(e,"tbody",t)||B(e,"thead",t);return G(t.editing.view.domConverter.mapViewToDom(l))}function B(e,t,l){return[...[...l.editing.mapper.toViewElement(e).getChildren()].find(e=>e.is("element","table")).getChildren()].find(e=>e.is("element",t))}function G(e){let t=o.global.window.getComputedStyle(e);return"border-box"===t.boxSizing?parseFloat(t.width)-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight)-parseFloat(t.borderLeftWidth)-parseFloat(t.borderRightWidth):parseFloat(t.width)}function K(e){return Math.round(("number"==typeof e?e:parseFloat(e))*100)/100}function $(e){return e.map(e=>"number"==typeof e?e:parseFloat(e)).filter(e=>!Number.isNaN(e)).reduce((e,t)=>e+t,0)}function Y(e){let t=function(e){let t=e.filter(e=>"auto"===e).length;if(0===t)return e.map(e=>K(e));let l=Math.max((100-$(e))/t,5);return e.map(e=>"auto"===e?l:e).map(e=>K(e))}(e.map(e=>"auto"===e?e:parseFloat(e.replace("%","")))),l=$(t);return 100!==l&&(t=t.map(e=>K(100*e/l)).map((e,t,l)=>t!==l.length-1?e:K(e+100-$(l)))),t.map(e=>e+"%")}function j(e,t,l,n){for(let i=0;i<Math.max(l.length,e.length);i++){let o=e[i],r=l[i];r?o?n.setAttribute("columnWidth",r,o):n.appendElement("tableColumn",{columnWidth:r},t):n.remove(o)}}function q(e){return e.is("element","tableColumnGroup")?e:Array.from(e.getChildren()).find(e=>e.is("element","tableColumnGroup"))}function X(e){let t=q(e);return t?Array.from(t.getChildren()):[]}class Z extends n.Sy{static get pluginName(){return"TableUtils"}static get isOfficialPlugin(){return!0}init(){this.decorate("insertColumns"),this.decorate("insertRows")}getCellLocation(e){let t=e.parent,l=t.parent,n=l.getChildIndex(t);for(let{cell:t,row:i,column:o}of new f(l,{row:n}))if(t===e)return{row:i,column:o}}createTable(e,t){let l=e.createElement("table"),n=t.rows||2,i=t.columns||2;return J(e,l,0,n,i),t.headingRows&&c("headingRows",Math.min(t.headingRows,n),l,e,0),t.headingColumns&&c("headingColumns",Math.min(t.headingColumns,i),l,e,0),l}insertRows(e,t={}){let l=this.editor.model,n=t.at||0,i=t.rows||1,r=void 0!==t.copyStructureFromAbove,s=t.copyStructureFromAbove?n-1:n,a=this.getRows(e),d=this.getColumns(e);if(n>a)throw new o.Bb("tableutils-insertrows-insert-out-of-range",this,{options:t});l.change(t=>{let l=e.getAttribute("headingRows")||0;if(l>n&&c("headingRows",l+i,e,t,0),!r&&(0===n||n===a)){J(t,e,n,i,d);return}let o=new f(e,{endRow:r?Math.max(n,s):n}),u=Array(d).fill(1);for(let{row:e,column:l,cellHeight:a,cellWidth:d,cell:c}of o){let o=e+a-1,m=e<n&&n<=o,h=e<=s&&s<=o;m?(t.setAttribute("rowspan",a+i,c),u[l]=-d):r&&h&&(u[l]=d)}for(let l=0;l<i;l++){let l=t.createElement("tableRow");t.insert(l,e,n);for(let e=0;e<u.length;e++){let n=u[e],i=t.createPositionAt(l,"end");n>0&&m(t,i,n>1?{colspan:n}:void 0),e+=Math.abs(n)-1}}})}insertColumns(e,t={}){let l=this.editor.model,n=t.at||0,i=t.columns||1;l.change(t=>{let l=e.getAttribute("headingColumns");n<l&&t.setAttribute("headingColumns",l+i,e);let o=this.getColumns(e);if(0===n||o===n){for(let l of e.getChildren())l.is("element","tableRow")&&Q(i,t,t.createPositionAt(l,n?"end":0));return}let r=new f(e,{column:n,includeAllSlots:!0});for(let e of r){let{row:l,cell:o,cellAnchorColumn:s,cellAnchorRow:a,cellWidth:d,cellHeight:u}=e;if(s<n){t.setAttribute("colspan",d+i,o);let e=a+u-1;for(let t=l;t<=e;t++)r.skipRow(t)}else Q(i,t,e.getPositionBefore())}})}removeRows(e,t){let l=this.editor.model,n=t.rows||1,i=this.getRows(e),r=t.at,s=r+n-1;if(s>i-1)throw new o.Bb("tableutils-removerows-row-index-out-of-range",this,{table:e,options:t});l.change(t=>{let l={first:r,last:s},{cellsToMove:n,cellsToTrim:i}=function(e,{first:t,last:l}){let n=new Map,i=[];for(let{row:o,column:r,cellHeight:s,cell:a}of new f(e,{endRow:l})){let e=o+s-1;if(o>=t&&o<=l&&e>l){let e=s-(l-o+1);n.set(r,{cell:a,rowspan:e})}if(o<t&&e>=t){let n;n=e>=l?l-t+1:e-t+1,i.push({cell:a,rowspan:s-n})}}return{cellsToMove:n,cellsToTrim:i}}(e,l);n.size&&function(e,t,l,n){let i;let o=[...new f(e,{includeAllSlots:!0,row:t})],r=e.getChild(t);for(let{column:e,cell:t,isAnchor:s}of o)if(l.has(e)){let{cell:t,rowspan:o}=l.get(e),s=i?n.createPositionAfter(i):n.createPositionAt(r,0);n.move(n.createRangeOn(t),s),c("rowspan",o,t,n),i=t}else s&&(i=t)}(e,s+1,n,t);for(let l=s;l>=r;l--)t.remove(e.getChild(l));for(let{rowspan:e,cell:l}of i)c("rowspan",e,l,t);(function(e,{first:t,last:l},n){let i=e.getAttribute("headingRows")||0;t<i&&c("headingRows",l<i?i-(l-t+1):t,e,n,0)})(e,l,t),k(e,this)||z(e,this)})}removeColumns(e,t){let l=this.editor.model,n=t.at,i=t.columns||1,o=t.at+i-1;l.change(t=>{!function(e,t,l){let n=e.getAttribute("headingColumns")||0;if(n&&t.first<n){let i=Math.min(n-1,t.last)-t.first+1;l.setAttribute("headingColumns",n-i,e)}}(e,{first:n,last:o},t);let l=X(e);for(let i=o;i>=n;i--){for(let{cell:l,column:n,cellWidth:o}of[...new f(e)])n<=i&&o>1&&n+o>i?c("colspan",o-1,l,t):n===i&&t.remove(l);if(l[i]){let e=0===i?l[1]:l[i-1],n=parseFloat(l[i].getAttribute("columnWidth")),o=parseFloat(e.getAttribute("columnWidth"));t.remove(l[i]),t.setAttribute("columnWidth",n+o+"%",e)}}z(e,this)||k(e,this)})}splitCellVertically(e,t=2){let l=this.editor.model,n=e.parent.parent,i=parseInt(e.getAttribute("rowspan")||"1"),o=parseInt(e.getAttribute("colspan")||"1");l.change(l=>{if(o>1){let{newCellsSpan:n,updatedSpan:r}=ee(o,t);c("colspan",r,e,l);let s={};n>1&&(s.colspan=n),i>1&&(s.rowspan=i),Q(o>t?t-1:o-1,l,l.createPositionAfter(e),s)}if(o<t){let r=t-o,s=[...new f(n)],{column:a}=s.find(({cell:t})=>t===e);for(let{cell:t,cellWidth:n}of s.filter(({cell:t,cellWidth:l,column:n})=>t!==e&&n===a||n<a&&n+l>a))l.setAttribute("colspan",n+r,t);let d={};i>1&&(d.rowspan=i),Q(r,l,l.createPositionAfter(e),d);let u=n.getAttribute("headingColumns")||0;u>a&&c("headingColumns",u+r,n,l)}})}splitCellHorizontally(e,t=2){let l=this.editor.model,n=e.parent,i=n.parent,o=i.getChildIndex(n),r=parseInt(e.getAttribute("rowspan")||"1"),s=parseInt(e.getAttribute("colspan")||"1");l.change(l=>{if(r>1){let n=[...new f(i,{startRow:o,endRow:o+r-1,includeAllSlots:!0})],{newCellsSpan:a,updatedSpan:d}=ee(r,t);c("rowspan",d,e,l);let{column:u}=n.find(({cell:t})=>t===e),m={};a>1&&(m.rowspan=a),s>1&&(m.colspan=s);let h=0;for(let e of n){let{column:t,row:n}=e,i=t===u;h>=a&&i&&(h=0),n>=o+d&&i&&(h||Q(1,l,e.getPositionBefore(),m),h++)}}if(r<t){let n=t-r;for(let{cell:t,cellHeight:r,row:s}of[...new f(i,{startRow:0,endRow:o})])if(t!==e&&s+r>o){let e=r+n;l.setAttribute("rowspan",e,t)}let a={};s>1&&(a.colspan=s),J(l,i,o+1,n,1,a);let d=i.getAttribute("headingRows")||0;d>o&&c("headingRows",d+n,i,l)}})}getColumns(e){return[...e.getChild(0).getChildren()].filter(e=>e.is("element","tableCell")).reduce((e,t)=>e+parseInt(t.getAttribute("colspan")||"1"),0)}getRows(e){return Array.from(e.getChildren()).reduce((e,t)=>t.is("element","tableRow")?e+1:e,0)}createTableWalker(e,t={}){return new f(e,t)}getSelectedTableCells(e){let t=[];for(let l of this.sortRanges(e.getRanges())){let e=l.getContainedElement();e&&e.is("element","tableCell")&&t.push(e)}return t}getTableCellsContainingSelection(e){let t=[];for(let l of e.getRanges()){let e=l.start.findAncestor("tableCell");e&&t.push(e)}return t}getSelectionAffectedTableCells(e){let t=this.getSelectedTableCells(e);return t.length?t:this.getTableCellsContainingSelection(e)}getRowIndexes(e){let t=e.map(e=>e.parent.index);return this._getFirstLastIndexesObject(t)}getColumnIndexes(e){let t=[...new f(e[0].findAncestor("table"))].filter(t=>e.includes(t.cell)).map(e=>e.column);return this._getFirstLastIndexesObject(t)}isSelectionRectangular(e){if(e.length<2||!this._areCellInTheSameTableSection(e))return!1;let t=new Set,l=new Set,n=0;for(let i of e){let{row:e,column:o}=this.getCellLocation(i),r=parseInt(i.getAttribute("rowspan"))||1,s=parseInt(i.getAttribute("colspan"))||1;t.add(e),l.add(o),r>1&&t.add(e+r-1),s>1&&l.add(o+s-1),n+=r*s}return function(e,t){let l=Array.from(e.values()),n=Array.from(t.values());return(Math.max(...l)-Math.min(...l)+1)*(Math.max(...n)-Math.min(...n)+1)}(t,l)==n}sortRanges(e){return Array.from(e).sort(et)}_getFirstLastIndexesObject(e){let t=e.sort((e,t)=>e-t);return{first:t[0],last:t[t.length-1]}}_areCellInTheSameTableSection(e){let t=e[0].findAncestor("table"),l=this.getRowIndexes(e),n=parseInt(t.getAttribute("headingRows"))||0;if(!this._areIndexesInSameSection(l,n))return!1;let i=this.getColumnIndexes(e),o=parseInt(t.getAttribute("headingColumns"))||0;return this._areIndexesInSameSection(i,o)}_areIndexesInSameSection({first:e,last:t},l){return e<l==t<l}}function J(e,t,l,n,i,o={}){for(let r=0;r<n;r++){let n=e.createElement("tableRow");e.insert(n,t,l),Q(i,e,e.createPositionAt(n,"end"),o)}}function Q(e,t,l,n={}){for(let i=0;i<e;i++)m(t,l,n)}function ee(e,t){if(e<t)return{newCellsSpan:1,updatedSpan:1};let l=Math.floor(e/t);return{newCellsSpan:l,updatedSpan:e-l*t+l}}function et(e,t){let l=e.start,n=t.start;return l.isBefore(n)?-1:1}class el extends n.mY{refresh(){let e=this.editor.plugins.get(Z),t=e.getSelectedTableCells(this.editor.model.document.selection);this.isEnabled=e.isSelectionRectangular(t)}execute(){let e=this.editor.model,t=this.editor.plugins.get(Z);e.change(l=>{let n=t.getSelectedTableCells(e.document.selection),i=n.shift(),{mergeWidth:o,mergeHeight:r}=function(e,t,l){let n=0,i=0;for(let e of t){let{row:t,column:o}=l.getCellLocation(e);n=ei(e,o,n,"colspan"),i=ei(e,t,i,"rowspan")}let{row:o,column:r}=l.getCellLocation(e);return{mergeWidth:n-r,mergeHeight:i-o}}(i,n,t);for(let e of(c("colspan",o,i,l),c("rowspan",r,i,l),n))en(e)||(en(i)&&l.remove(l.createRangeIn(i)),l.move(l.createRangeIn(e),l.createPositionAt(i,"end"))),l.remove(e);M(i.findAncestor("table"),t),l.setSelection(i,"in")})}}function en(e){let t=e.getChild(0);return 1==e.childCount&&t.is("element","paragraph")&&t.isEmpty}function ei(e,t,l,n){return Math.max(l,t+parseInt(e.getAttribute(n)||"1"))}class eo extends n.mY{constructor(e){super(e),this.affectsData=!1}refresh(){let e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){let e=this.editor.model,t=this.editor.plugins.get("TableUtils"),l=t.getSelectionAffectedTableCells(e.document.selection),n=t.getRowIndexes(l),i=l[0].findAncestor("table"),o=[];for(let t=n.first;t<=n.last;t++)for(let l of i.getChild(t).getChildren())o.push(e.createRangeOn(l));e.change(e=>{e.setSelection(o)})}}class er extends n.mY{constructor(e){super(e),this.affectsData=!1}refresh(){let e=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(this.editor.model.document.selection);this.isEnabled=e.length>0}execute(){let e=this.editor.plugins.get("TableUtils"),t=this.editor.model,l=e.getSelectionAffectedTableCells(t.document.selection),n=l[0],i=l.pop(),o=n.findAncestor("table"),r=e.getCellLocation(n),s=e.getCellLocation(i),a=Math.min(r.column,s.column),d=Math.max(r.column,s.column),u=[];for(let e of new f(o,{startColumn:a,endColumn:d}))u.push(t.createRangeOn(e.cell));t.change(e=>{e.setSelection(u)})}}function es(e,t){let l=!1;for(let n of e.getChildren())l=ea(n,t)||l;return l}function ea(e,t){if(0==e.childCount)return t.insertElement("paragraph",e),!0;let l=Array.from(e.getChildren()).filter(e=>e.is("$text"));for(let e of l)t.wrap(t.createRangeOn(e),"paragraph");return!!l.length}class ed extends n.Sy{_additionalSlots;static get pluginName(){return"TableEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[Z]}constructor(e){super(e),this._additionalSlots=[]}init(){let e=this.editor,t=e.model,l=t.schema,n=e.conversion,i=e.plugins.get(Z);l.register("table",{inheritAllFrom:"$blockObject",allowAttributes:["headingRows","headingColumns"]}),l.register("tableRow",{allowIn:"table",isLimit:!0}),l.register("tableCell",{allowContentOf:"$container",allowIn:"tableRow",allowAttributes:["colspan","rowspan"],isLimit:!0,isSelectable:!0}),n.for("upcast").add(e=>{e.on("element:figure",(e,t,l)=>{if(!l.consumable.test(t.viewItem,{name:!0,classes:"table"}))return;let n=function(e){for(let t of e.getChildren())if(t.is("element","table"))return t}(t.viewItem);if(!n||!l.consumable.test(n,{name:!0}))return;l.consumable.consume(t.viewItem,{name:!0,classes:"table"});let i=l.convertItem(n,t.modelCursor),r=(0,o.Ps)(i.modelRange.getItems());if(!r){l.consumable.revert(t.viewItem,{name:!0,classes:"table"});return}l.convertChildren(t.viewItem,l.writer.createPositionAt(r,"end")),l.updateConversionResult(r,t)})}),n.for("upcast").add(e=>{e.on("element:table",(e,t,l)=>{let n=t.viewItem;if(!l.consumable.test(n,{name:!0}))return;let{rows:i,headingRows:o,headingColumns:r}=function(e){let t,l,n=0,i=[],o=[];for(let r of Array.from(e.getChildren()))if("tbody"===r.name||"thead"===r.name||"tfoot"===r.name)for(let e of("thead"!==r.name||l||(l=r),Array.from(r.getChildren()).filter(e=>e.is("element","tr"))))if(l&&r===l||"tbody"===r.name&&Array.from(e.getChildren()).length&&Array.from(e.getChildren()).every(e=>e.is("element","th")))n++,i.push(e);else{o.push(e);let l=function(e){let t=0,l=0,n=Array.from(e.getChildren()).filter(e=>"th"===e.name||"td"===e.name);for(;l<n.length&&"th"===n[l].name;)t+=parseInt(n[l].getAttribute("colspan")||"1"),l++;return t}(e);(!t||l<t)&&(t=l)}return{headingRows:n,headingColumns:t||0,rows:[...i,...o]}}(n),s={};r&&(s.headingColumns=r),o&&(s.headingRows=o);let a=l.writer.createElement("table",s);if(l.safeInsert(a,t.modelCursor)){if(l.consumable.consume(n,{name:!0}),i.forEach(e=>l.convertItem(e,l.writer.createPositionAt(a,"end"))),l.convertChildren(n,l.writer.createPositionAt(a,"end")),a.isEmpty){let e=l.writer.createElement("tableRow");l.writer.insert(e,l.writer.createPositionAt(a,"end")),m(l.writer,l.writer.createPositionAt(e,"end"))}l.updateConversionResult(a,t)}})}),n.for("editingDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:p(i,{asWidget:!0,additionalSlots:this._additionalSlots})}),n.for("dataDowncast").elementToStructure({model:{name:"table",attributes:["headingRows"]},view:p(i,{additionalSlots:this._additionalSlots})}),n.for("upcast").elementToElement({model:"tableRow",view:"tr"}),n.for("upcast").add(e=>{e.on("element:tr",(e,t)=>{t.viewItem.isEmpty&&0==t.modelCursor.index&&e.stop()},{priority:"high"})}),n.for("downcast").elementToElement({model:"tableRow",view:(e,{writer:t})=>e.isEmpty?t.createEmptyElement("tr"):t.createContainerElement("tr")}),n.for("upcast").elementToElement({model:"tableCell",view:"td"}),n.for("upcast").elementToElement({model:"tableCell",view:"th"}),n.for("upcast").add(g("td")),n.for("upcast").add(g("th")),n.for("editingDowncast").elementToElement({model:"tableCell",view:w({asWidget:!0})}),n.for("dataDowncast").elementToElement({model:"tableCell",view:w()}),n.for("editingDowncast").elementToElement({model:"paragraph",view:C({asWidget:!0}),converterPriority:"high"}),n.for("dataDowncast").elementToElement({model:"paragraph",view:C(),converterPriority:"high"}),n.for("downcast").attributeToAttribute({model:"colspan",view:"colspan"}),n.for("upcast").attributeToAttribute({model:{key:"colspan",value:eu("colspan")},view:"colspan"}),n.for("downcast").attributeToAttribute({model:"rowspan",view:"rowspan"}),n.for("upcast").attributeToAttribute({model:{key:"rowspan",value:eu("rowspan")},view:"rowspan"}),e.config.define("table.defaultHeadings.rows",0),e.config.define("table.defaultHeadings.columns",0),e.commands.add("insertTable",new v(e)),e.commands.add("insertTableRowAbove",new _(e,{order:"above"})),e.commands.add("insertTableRowBelow",new _(e,{order:"below"})),e.commands.add("insertTableColumnLeft",new T(e,{order:"left"})),e.commands.add("insertTableColumnRight",new T(e,{order:"right"})),e.commands.add("removeTableRow",new H(e)),e.commands.add("removeTableColumn",new W(e)),e.commands.add("splitTableCellVertically",new R(e,{direction:"vertically"})),e.commands.add("splitTableCellHorizontally",new R(e,{direction:"horizontally"})),e.commands.add("mergeTableCells",new el(e)),e.commands.add("mergeTableCellRight",new N(e,{direction:"right"})),e.commands.add("mergeTableCellLeft",new N(e,{direction:"left"})),e.commands.add("mergeTableCellDown",new N(e,{direction:"down"})),e.commands.add("mergeTableCellUp",new N(e,{direction:"up"})),e.commands.add("setTableColumnHeader",new L(e)),e.commands.add("setTableRowHeader",new F(e)),e.commands.add("selectTableRow",new eo(e)),e.commands.add("selectTableColumn",new er(e)),function(e){e.document.registerPostFixer(t=>(function(e,t){let l=t.document.differ.getChanges(),n=!1,i=new Set;for(let t of l){let l=null;"insert"==t.type&&"table"==t.name&&(l=t.position.nodeAfter),("insert"==t.type||"remove"==t.type)&&("tableRow"==t.name||"tableCell"==t.name)&&(l=t.position.findAncestor("table")),function(e){if("attribute"!==e.type)return!1;let t=e.attributeKey;return"headingRows"===t||"colspan"===t||"rowspan"===t}(t)&&(l=t.range.start.findAncestor("table")),l&&!i.has(l)&&(n=function(e,t){let l=!1,n=function(e){let t=parseInt(e.getAttribute("headingRows")||"0"),l=Array.from(e.getChildren()).reduce((e,t)=>t.is("element","tableRow")?e+1:e,0),n=[];for(let{row:i,cell:o,cellHeight:r}of new f(e)){if(r<2)continue;let e=i<t?t:l;if(i+r>e){let t=e-i;n.push({cell:o,rowspan:t})}}return n}(e);if(n.length)for(let e of(l=!0,n))c("rowspan",e.rowspan,e.cell,t,1);return l}(l,e)||n,n=function(e,t){let l=!1,n=function(e){let t=Array(e.childCount).fill(0);for(let{rowIndex:l}of new f(e,{includeAllSlots:!0}))t[l]++;return t}(e),i=[];for(let[t,l]of n.entries())!l&&e.getChild(t).is("element","tableRow")&&i.push(t);if(i.length)for(let o of(l=!0,i.reverse()))t.remove(e.getChild(o)),n.splice(o,1);let o=n.filter((t,l)=>e.getChild(l).is("element","tableRow")),r=o[0];if(!o.every(e=>e===r)){let n=o.reduce((e,t)=>t>e?t:e,0);for(let[i,r]of o.entries()){let o=n-r;if(o){for(let l=0;l<o;l++)m(t,t.createPositionAt(e.getChild(i),"end"));l=!0}}}return l}(l,e)||n,i.add(l))}return n})(t,e))}(t),function(e){e.document.registerPostFixer(t=>(function(e,t){let l=t.document.differ.getChanges(),n=!1;for(let t of l){var i;"insert"==t.type&&"table"==t.name&&(n=function(e,t){let l=!1;for(let n of e.getChildren())n.is("element","tableRow")&&(l=es(n,t)||l);return l}(t.position.nodeAfter,e)||n),"insert"==t.type&&"tableRow"==t.name&&(n=es(t.position.nodeAfter,e)||n),"insert"==t.type&&"tableCell"==t.name&&(n=ea(t.position.nodeAfter,e)||n),("remove"==t.type||"insert"==t.type)&&(i=t).position.parent.is("element","tableCell")&&("insert"==i.type&&"$text"==i.name||"remove"==i.type)&&(n=ea(t.position.parent,e)||n)}return n})(t,e))}(t),this.listenTo(t.document,"change:data",()=>{(function(e,t){for(let l of e.document.differ.getChanges()){let e;let n=!1;if("attribute"==l.type){let t=l.range.start.nodeAfter;if(!t||!t.is("element","table")||"headingRows"!=l.attributeKey&&"headingColumns"!=l.attributeKey)continue;e=t,n="headingRows"==l.attributeKey}else("tableRow"==l.name||"tableCell"==l.name)&&(e=l.position.findAncestor("table"),n="tableRow"==l.name);if(!e)continue;let i=e.getAttribute("headingRows")||0,o=e.getAttribute("headingColumns")||0;for(let l of new f(e)){let e=l.row<i||l.column<o?"th":"td",r=t.mapper.toViewElement(l.cell);r&&r.is("element")&&r.name!=e&&t.reconvertItem(n?l.cell.parent:l.cell)}}})(t,e.editing),function(e,t){let l=e.document.differ,n=new Set;for(let e of l.getChanges()){let t="attribute"==e.type?e.range.start.parent:e.position.parent;t.is("element","tableCell")&&n.add(t)}for(let e of n.values())for(let l of Array.from(e.getChildren()).filter(e=>(function(e,t){if(!e.is("element","paragraph"))return!1;let l=t.toViewElement(e);return!!l&&A(e)!==l.is("element","span")})(e,t.mapper)))t.reconvertItem(l)}(t,e.editing)})}registerAdditionalSlot(e){this._additionalSlots.push(e)}}function eu(e){return t=>{let l=parseInt(t.getAttribute(e));return Number.isNaN(l)||l<=0?null:l}}class ec extends r.G7{items;keystrokes;focusTracker;constructor(e){super(e);let t=this.bindTemplate;this.items=this._createGridCollection(),this.keystrokes=new o.VD,this.focusTracker=new o.Rh,this.set("rows",0),this.set("columns",0),this.bind("label").to(this,"columns",this,"rows",(e,t)=>`${t} \xd7 ${e}`),this.setTemplate({tag:"div",attributes:{class:["ck"]},children:[{tag:"div",attributes:{class:["ck-insert-table-dropdown__grid"]},on:{"mouseover@.ck-insert-table-dropdown-grid-box":t.to("boxover")},children:this.items},{tag:"div",attributes:{class:["ck","ck-insert-table-dropdown__label"],"aria-hidden":!0},children:[{text:t.to("label")}]}],on:{mousedown:t.to(e=>{e.preventDefault()}),click:t.to(()=>{this.fire("execute")})}}),this.on("boxover",(e,t)=>{let{row:l,column:n}=t.target.dataset;this.items.get((parseInt(l,10)-1)*10+(parseInt(n,10)-1)).focus()}),this.focusTracker.on("change:focusedElement",(e,t,l)=>{if(!l)return;let{row:n,column:i}=l.dataset;this.set({rows:parseInt(n),columns:parseInt(i)})}),this.on("change:columns",()=>this._highlightGridBoxes()),this.on("change:rows",()=>this._highlightGridBoxes())}render(){for(let e of(super.render(),(0,r.IJ)({keystrokeHandler:this.keystrokes,focusTracker:this.focusTracker,gridItems:this.items,numberOfColumns:10,uiLanguageDirection:this.locale&&this.locale.uiLanguageDirection}),this.items))this.focusTracker.add(e.element);this.keystrokes.listenTo(this.element)}reset(){this.set({rows:1,columns:1})}focus(){this.items.get(0).focus()}focusLast(){this.items.get(0).focus()}_highlightGridBoxes(){let e=this.rows,t=this.columns;this.items.map((l,n)=>{l.set("isOn",Math.floor(n/10)<e&&n%10<t)})}_createGridButton(e,t,l,n){let i=new r.r5(e);return i.set({label:n,class:"ck-insert-table-dropdown-grid-box"}),i.extendTemplate({attributes:{"data-row":t,"data-column":l}}),i}_createGridCollection(){let e=[];for(let t=0;t<100;t++){let l=Math.floor(t/10),n=t%10,i=`${l+1} \xd7 ${n+1}`;e.push(this._createGridButton(this.locale,l+1,n+1,i))}return this.createCollection(e)}}class em extends n.Sy{static get pluginName(){return"TableUI"}static get isOfficialPlugin(){return!0}init(){let e=this.editor,t=this.editor.t,l="ltr"===e.locale.contentLanguageDirection;e.ui.componentFactory.add("insertTable",l=>{let i;let o=e.commands.get("insertTable"),s=(0,r.t9)(l);return s.bind("isEnabled").to(o),s.buttonView.set({icon:n.ci.table,label:t("Insert table"),tooltip:!0}),s.on("change:isOpen",()=>{i||(i=new ec(l),s.panelView.children.add(i),i.delegate("execute").to(s),s.on("execute",()=>{e.execute("insertTable",{rows:i.rows,columns:i.columns}),e.editing.view.focus()}))}),s}),e.ui.componentFactory.add("menuBar:insertTable",l=>{let i=e.commands.get("insertTable"),o=new r.AH(l),s=new ec(l);return s.delegate("execute").to(o),o.on("change:isOpen",(e,t,l)=>{l||s.reset()}),s.on("execute",()=>{e.execute("insertTable",{rows:s.rows,columns:s.columns}),e.editing.view.focus()}),o.buttonView.set({label:t("Table"),icon:n.ci.table}),o.panelView.children.add(s),o.bind("isEnabled").to(i),o}),e.ui.componentFactory.add("tableColumn",e=>{let n=[{type:"switchbutton",model:{commandName:"setTableColumnHeader",label:t("Header column"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:l?"insertTableColumnLeft":"insertTableColumnRight",label:t("Insert column left")}},{type:"button",model:{commandName:l?"insertTableColumnRight":"insertTableColumnLeft",label:t("Insert column right")}},{type:"button",model:{commandName:"removeTableColumn",label:t("Delete column")}},{type:"button",model:{commandName:"selectTableColumn",label:t("Select column")}}];return this._prepareDropdown(t("Column"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M18 7v1H2V7h16zm0 5v1H2v-1h16z" opacity=".6"/><path d="M14 1v18a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V1a1 1 0 0 1 1-1h6a1 1 0 0 1 1 1zm-2 1H8v4h4V2zm0 6H8v4h4V8zm0 6H8v4h4v-4z"/></svg>',n,e)}),e.ui.componentFactory.add("tableRow",e=>{let l=[{type:"switchbutton",model:{commandName:"setTableRowHeader",label:t("Header row"),bindIsOn:!0}},{type:"separator"},{type:"button",model:{commandName:"insertTableRowAbove",label:t("Insert row above")}},{type:"button",model:{commandName:"insertTableRowBelow",label:t("Insert row below")}},{type:"button",model:{commandName:"removeTableRow",label:t("Delete row")}},{type:"button",model:{commandName:"selectTableRow",label:t("Select row")}}];return this._prepareDropdown(t("Row"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v16h-1V2z" opacity=".6"/><path d="M1 6h18a1 1 0 0 1 1 1v6a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1zm1 2v4h4V8H2zm6 0v4h4V8H8zm6 0v4h4V8h-4z"/></svg>',l,e)}),e.ui.componentFactory.add("mergeTableCells",e=>{let n=[{type:"button",model:{commandName:"mergeTableCellUp",label:t("Merge cell up")}},{type:"button",model:{commandName:l?"mergeTableCellRight":"mergeTableCellLeft",label:t("Merge cell right")}},{type:"button",model:{commandName:"mergeTableCellDown",label:t("Merge cell down")}},{type:"button",model:{commandName:l?"mergeTableCellLeft":"mergeTableCellRight",label:t("Merge cell left")}},{type:"separator"},{type:"button",model:{commandName:"splitTableCellVertically",label:t("Split cell vertically")}},{type:"button",model:{commandName:"splitTableCellHorizontally",label:t("Split cell horizontally")}}];return this._prepareMergeSplitButtonDropdown(t("Merge cells"),'<svg viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M2.5 1h15A1.5 1.5 0 0 1 19 2.5v15a1.5 1.5 0 0 1-1.5 1.5h-15A1.5 1.5 0 0 1 1 17.5v-15A1.5 1.5 0 0 1 2.5 1zM2 2v16h16V2H2z" opacity=".6"/><path d="M7 2h1v16H7V2zm5 0h1v7h-1V2zm6 5v1H2V7h16zM8 12v1H2v-1h6z" opacity=".6"/><path d="M7 7h12a1 1 0 0 1 1 1v11a1 1 0 0 1-1 1H7a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1zm1 2v9h10V9H8z"/></svg>',n,e)})}_prepareDropdown(e,t,l,n){let i=this.editor,o=(0,r.t9)(n),s=this._fillDropdownWithListOptions(o,l);return o.buttonView.set({label:e,icon:t,tooltip:!0}),o.bind("isEnabled").toMany(s,"isEnabled",(...e)=>e.some(e=>e)),this.listenTo(o,"execute",e=>{i.execute(e.source.commandName),e.source instanceof r.BM||i.editing.view.focus()}),o}_prepareMergeSplitButtonDropdown(e,t,l,n){let i=this.editor,o=(0,r.t9)(n,r.Rm),s="mergeTableCells",a=i.commands.get(s),d=this._fillDropdownWithListOptions(o,l);return o.buttonView.set({label:e,icon:t,tooltip:!0,isEnabled:!0}),o.bind("isEnabled").toMany([a,...d],"isEnabled",(...e)=>e.some(e=>e)),this.listenTo(o.buttonView,"execute",()=>{i.execute(s),i.editing.view.focus()}),this.listenTo(o,"execute",e=>{i.execute(e.source.commandName),i.editing.view.focus()}),o}_fillDropdownWithListOptions(e,t){let l=this.editor,n=[],i=new o.FE;for(let e of t)!function(e,t,l,n){if("button"===e.type||"switchbutton"===e.type){let n=e.model=new r.jz(e.model),{commandName:i,bindIsOn:o}=e.model,s=t.commands.get(i);l.push(s),n.set({commandName:i}),n.bind("isEnabled").to(s),o&&n.bind("isOn").to(s,"value"),n.set({withText:!0})}n.add(e)}(e,l,n,i);return(0,r.Pm)(e,i),n}}class eh extends n.Sy{static get pluginName(){return"TableSelection"}static get isOfficialPlugin(){return!0}static get requires(){return[Z,Z]}init(){let e=this.editor,t=e.model,l=e.editing.view;this.listenTo(t,"deleteContent",(e,t)=>this._handleDeleteContent(e,t),{priority:"high"}),this.listenTo(l.document,"insertText",(e,t)=>this._handleInsertTextEvent(e,t),{priority:"high"}),this._defineSelectionConverter(),this._enablePluginDisabling()}getSelectedTableCells(){let e=this.editor.plugins.get(Z),t=this.editor.model.document.selection,l=e.getSelectedTableCells(t);return 0==l.length?null:l}getSelectionAsFragment(){let e=this.editor.plugins.get(Z),t=this.getSelectedTableCells();return t?this.editor.model.change(l=>{let n=l.createDocumentFragment(),{first:i,last:o}=e.getColumnIndexes(t),{first:r,last:s}=e.getRowIndexes(t),a=t[0].findAncestor("table"),d=s,u=o;if(e.isSelectionRectangular(t)){let e={firstColumn:i,lastColumn:o,firstRow:r,lastRow:s};d=D(a,e),u=V(a,e)}let c=S(a,{startRow:r,startColumn:i,endRow:d,endColumn:u},l);return l.insert(c,n,0),n}):null}setCellSelection(e,t){let l=this._getCellsToSelect(e,t);this.editor.model.change(e=>{e.setSelection(l.cells.map(t=>e.createRangeOn(t)),{backward:l.backward})})}getFocusCell(){let e=[...this.editor.model.document.selection.getRanges()].pop().getContainedElement();return e&&e.is("element","tableCell")?e:null}getAnchorCell(){let e=this.editor.model.document.selection,t=(0,o.Ps)(e.getRanges()).getContainedElement();return t&&t.is("element","tableCell")?t:null}_defineSelectionConverter(){let e=this.editor,t=new Set;e.conversion.for("editingDowncast").add(e=>e.on("selection",(e,l,n)=>{let i=n.writer;!function(e){for(let l of t)e.removeClass("ck-editor__editable_selected",l);t.clear()}(i);let o=this.getSelectedTableCells();if(!o)return;for(let e of o){let l=n.mapper.toViewElement(e);i.addClass("ck-editor__editable_selected",l),t.add(l)}let r=n.mapper.toViewElement(o[o.length-1]);i.setSelection(r,0)},{priority:"lowest"}))}_enablePluginDisabling(){let e=this.editor;this.on("change:isEnabled",()=>{if(!this.isEnabled){let t=this.getSelectedTableCells();t&&e.model.change(l=>{let n=l.createPositionAt(t[0],0),i=e.model.schema.getNearestSelectionRange(n);l.setSelection(i)})}})}_handleDeleteContent(e,t){let l=this.editor.plugins.get(Z),n=t[0],i=t[1],o=this.editor.model,r=!i||"backward"==i.direction,s=l.getSelectedTableCells(n);s.length&&(e.stop(),o.change(e=>{let t=s[r?s.length-1:0];o.change(e=>{for(let t of s)o.deleteContent(e.createSelection(t,"in"))});let l=o.schema.getNearestSelectionRange(e.createPositionAt(t,0));n.is("documentSelection")?e.setSelection(l):n.setTo(l)}))}_handleInsertTextEvent(e,t){let l=this.editor,n=this.getSelectedTableCells();if(!n)return;let i=l.editing.view,o=l.editing.mapper,r=n.map(e=>i.createRangeOn(o.toViewElement(e)));t.selection=i.createSelection(r)}_getCellsToSelect(e,t){let l=this.editor.plugins.get("TableUtils"),n=l.getCellLocation(e),i=l.getCellLocation(t),o=Math.min(n.row,i.row),r=Math.max(n.row,i.row),s=Math.min(n.column,i.column),a=Math.max(n.column,i.column),d=Array(r-o+1).fill(null).map(()=>[]);for(let{row:t,cell:l}of new f(e.findAncestor("table"),{startRow:o,endRow:r,startColumn:s,endColumn:a}))d[t-o].push(l);let u=i.row<n.row,c=i.column<n.column;return u&&d.reverse(),c&&d.forEach(e=>e.reverse()),{cells:d.flat(),backward:u||c}}}class eg extends n.Sy{static get pluginName(){return"TableClipboard"}static get isOfficialPlugin(){return!0}static get requires(){return[s.bH,s._l,eh,Z]}init(){let e=this.editor,t=e.editing.view.document;this.listenTo(t,"copy",(e,t)=>this._onCopyCut(e,t)),this.listenTo(t,"cut",(e,t)=>this._onCopyCut(e,t)),this.listenTo(e.model,"insertContent",(e,[t,l])=>this._onInsertContent(e,t,l),{priority:"high"}),this.decorate("_replaceTableSlotCell")}_onCopyCut(e,t){let l=this.editor.editing.view,n=this.editor.plugins.get(eh),i=this.editor.plugins.get(s.bH);n.getSelectedTableCells()&&("cut"!=e.name||this.editor.model.canEditAt(this.editor.model.document.selection))&&(t.preventDefault(),e.stop(),this.editor.model.enqueueChange({isUndoable:"cut"===e.name},()=>{let o=i._copySelectedFragmentWithMarkers(e.name,this.editor.model.document.selection,()=>n.getSelectionAsFragment());l.document.fire("clipboardOutput",{dataTransfer:t.dataTransfer,content:this.editor.data.toView(o),method:e.name})}))}_onInsertContent(e,t,l){if(l&&!l.is("documentSelection"))return;let n=this.editor.model,i=this.editor.plugins.get(Z),o=this.editor.plugins.get(s.bH),r=this.getTableIfOnlyTableInContent(t,n);if(!r)return;let a=i.getSelectionAffectedTableCells(n.document.selection);if(!a.length){M(r,i);return}e.stop(),t.is("documentFragment")?o._pasteMarkersIntoTransformedElement(t.markers,e=>this._replaceSelectedCells(r,a,e)):this.editor.model.change(e=>{this._replaceSelectedCells(r,a,e)})}_replaceSelectedCells(e,t,l){let n=this.editor.plugins.get(Z),i={width:n.getColumns(e),height:n.getRows(e)},o=function(e,t,l,n){let i=e[0].findAncestor("table"),o=n.getColumnIndexes(e),r=n.getRowIndexes(e),s={firstColumn:o.first,lastColumn:o.last,firstRow:r.first,lastRow:r.last},a=1===e.length;return a&&(s.lastRow+=t.height-1,s.lastColumn+=t.width-1,function(e,t,l,n){let i=n.getColumns(e),o=n.getRows(e);l>i&&n.insertColumns(e,{at:i,columns:l-i}),t>o&&n.insertRows(e,{at:o,rows:t-o})}(i,s.lastRow+1,s.lastColumn+1,n)),a||!n.isSelectionRectangular(e)?function(e,t,l){let{firstRow:n,lastRow:i,firstColumn:o,lastColumn:r}=t,s={first:n,last:i},a={first:o,last:r};eb(e,o,s,l),eb(e,r+1,s,l),ef(e,n,a,l),ef(e,i+1,a,l,n)}(i,s,l):(s.lastRow=D(i,s),s.lastColumn=V(i,s)),s}(t,i,l,n),r=o.lastRow-o.firstRow+1,s=o.lastColumn-o.firstColumn+1,a={startRow:0,startColumn:0,endRow:Math.min(r,i.height)-1,endColumn:Math.min(s,i.width)-1};e=S(e,a,l);let d=t[0].findAncestor("table"),u=this._replaceSelectedCellsWithPasted(e,i,d,o,l);if(this.editor.plugins.get("TableSelection").isEnabled){let e=n.sortRanges(u.map(e=>l.createRangeOn(e)));l.setSelection(e)}else l.setSelection(u[0],0);return d}_replaceSelectedCellsWithPasted(e,t,l,n,i){let o;let{width:r,height:s}=t,a=function(e,t,l){let n=Array(l).fill(null).map(()=>Array(t).fill(null));for(let{column:t,row:l,cell:i}of new f(e))n[l][t]=i;return n}(e,r,s),d=[...new f(l,{startRow:n.firstRow,endRow:n.lastRow,startColumn:n.firstColumn,endColumn:n.lastColumn,includeAllSlots:!0})],u=[];for(let e of d){let{row:t,column:l}=e;l===n.firstColumn&&(o=e.getPositionBefore());let d=t-n.firstRow,c=l-n.firstColumn,m=a[d%s][c%r],h=m?i.cloneElement(m):null,g=this._replaceTableSlotCell(e,h,o,i);g&&(P(g,t,l,n.lastRow,n.lastColumn,i),u.push(g),o=i.createPositionAfter(g))}let c=parseInt(l.getAttribute("headingRows")||"0"),m=parseInt(l.getAttribute("headingColumns")||"0"),h=n.firstRow<c&&c<=n.lastRow,g=n.firstColumn<m&&m<=n.lastColumn;if(h){let e=ef(l,c,{first:n.firstColumn,last:n.lastColumn},i,n.firstRow);u.push(...e)}if(g){let e=eb(l,m,{first:n.firstRow,last:n.lastRow},i);u.push(...e)}return u}_replaceTableSlotCell(e,t,l,n){let{cell:i,isAnchor:o}=e;return(o&&n.remove(i),t)?(n.insert(t,l),t):null}getTableIfOnlyTableInContent(e,t){if(!e.is("documentFragment")&&!e.is("element"))return null;if(e.is("element","table"))return e;if(1==e.childCount&&e.getChild(0).is("element","table"))return e.getChild(0);let l=t.createRangeIn(e);for(let e of l.getItems())if(e.is("element","table")){let n=t.createRange(l.start,t.createPositionBefore(e));if(t.hasContent(n,{ignoreWhitespaces:!0}))return null;let i=t.createRange(t.createPositionAfter(e),l.end);if(t.hasContent(i,{ignoreWhitespaces:!0}))return null;return e}return null}}function ef(e,t,l,n,i=0){if(!(t<1))return y(e,t,i).filter(({column:e,cellWidth:t})=>ep(e,t,l)).map(({cell:e})=>x(e,t,n))}function eb(e,t,l,n){if(!(t<1))return E(e,t).filter(({row:e,cellHeight:t})=>ep(e,t,l)).map(({cell:e,column:l})=>I(e,l,t,n))}function ep(e,t,l){let{first:n,last:i}=l;return e>=n&&e<=i||e<n&&e+t-1>=n}class ew extends n.Sy{static get pluginName(){return"TableKeyboard"}static get isOfficialPlugin(){return!0}static get requires(){return[eh,Z]}init(){let e=this.editor,t=e.editing.view.document,l=e.t;this.listenTo(t,"arrowKey",(...e)=>this._onArrowKey(...e),{context:"table"}),this.listenTo(t,"tab",(...e)=>this._handleTabOnSelectedTable(...e),{context:"figure"}),this.listenTo(t,"tab",(...e)=>this._handleTab(...e),{context:["th","td"]}),e.accessibility.addKeystrokeInfoGroup({id:"table",label:l("Keystrokes that can be used in a table cell"),keystrokes:[{label:l("Move the selection to the next cell"),keystroke:"Tab"},{label:l("Move the selection to the previous cell"),keystroke:"Shift+Tab"},{label:l("Insert a new table row (when in the last cell of a table)"),keystroke:"Tab"},{label:l("Navigate through the table"),keystroke:[["arrowup"],["arrowright"],["arrowdown"],["arrowleft"]]}]})}_handleTabOnSelectedTable(e,t){let l=this.editor,n=l.model.document.selection.getSelectedElement();n&&n.is("element","table")&&(t.preventDefault(),t.stopPropagation(),e.stop(),l.model.change(e=>{e.setSelection(e.createRangeIn(n.getChild(0).getChild(0)))}))}_handleTab(e,t){let l;let n=this.editor,i=this.editor.plugins.get(Z),o=this.editor.plugins.get("TableSelection"),r=n.model.document.selection,s=!t.shiftKey,a=i.getTableCellsContainingSelection(r)[0];if(a||(a=o.getFocusCell()),!a)return;t.preventDefault(),t.stopPropagation(),e.stop();let d=a.parent,u=d.parent,c=u.getChildIndex(d),m=d.getChildIndex(a),h=0===m;if(!s&&h&&0===c){n.model.change(e=>{e.setSelection(e.createRangeOn(u))});return}let g=m===d.childCount-1,f=c===i.getRows(u)-1;if(s&&f&&g&&(n.execute("insertTableRowBelow"),c===i.getRows(u)-1)){n.model.change(e=>{e.setSelection(e.createRangeOn(u))});return}if(s&&g)l=u.getChild(c+1).getChild(0);else if(!s&&h){let e=u.getChild(c-1);l=e.getChild(e.childCount-1)}else l=d.getChild(m+(s?1:-1));n.model.change(e=>{e.setSelection(e.createRangeIn(l))})}_onArrowKey(e,t){let l=this.editor,n=t.keyCode,i=(0,o.mA)(n,l.locale.contentLanguageDirection);this._handleArrowKeys(i,t.shiftKey)&&(t.preventDefault(),t.stopPropagation(),e.stop())}_handleArrowKeys(e,t){let l=this.editor.plugins.get(Z),n=this.editor.plugins.get("TableSelection"),i=this.editor.model,o=i.document.selection,r=["right","down"].includes(e),s=l.getSelectedTableCells(o);if(s.length){let l;return l=t?n.getFocusCell():r?s[s.length-1]:s[0],this._navigateFromCellInDirection(l,e,t),!0}let a=o.focus.findAncestor("tableCell");if(!a)return!1;if(!o.isCollapsed){if(t){if(o.isBackward==r&&!o.containsEntireContent(a))return!1}else{let e=o.getSelectedElement();if(!e||!i.schema.isObject(e))return!1}}return!!this._isSelectionAtCellEdge(o,a,r)&&(this._navigateFromCellInDirection(a,e,t),!0)}_isSelectionAtCellEdge(e,t,l){let n=this.editor.model,i=this.editor.model.schema,o=l?e.getLastPosition():e.getFirstPosition();if(!i.getLimitElement(o).is("element","tableCell"))return n.createPositionAt(t,l?"end":0).isTouching(o);let r=n.createSelection(o);return n.modifySelection(r,{direction:l?"forward":"backward"}),o.isEqual(r.focus)}_navigateFromCellInDirection(e,t,l=!1){let n=this.editor.model,i=e.findAncestor("table"),o=[...new f(i,{includeAllSlots:!0})],{row:r,column:s}=o[o.length-1],a=o.find(({cell:t})=>t==e),{row:d,column:u}=a;switch(t){case"left":u--;break;case"up":d--;break;case"right":u+=a.cellWidth;break;case"down":d+=a.cellHeight}let c=d<0||d>r,m=u<0&&d<=0,h=u>s&&d>=r;if(c||m||h){n.change(e=>{e.setSelection(e.createRangeOn(i))});return}u<0?(u=l?0:s,d--):u>s&&(u=l?s:0,d++);let g=o.find(e=>e.row==d&&e.column==u).cell,b=["right","down"].includes(t),p=this.editor.plugins.get("TableSelection");if(l&&p.isEnabled){let t=p.getAnchorCell()||e;p.setCellSelection(t,g)}else{let e=n.createPositionAt(g,b?0:"end");n.change(t=>{t.setSelection(e)})}}}class eC extends a.qZ{domEventType=["mousemove","mouseleave"];onDomEvent(e){this.fire(e.type,e)}}class eA extends n.Sy{static get pluginName(){return"TableMouse"}static get isOfficialPlugin(){return!0}static get requires(){return[eh,Z]}init(){this.editor.editing.view.addObserver(eC),this._enableShiftClickSelection(),this._enableMouseDragSelection()}_enableShiftClickSelection(){let e=this.editor,t=e.plugins.get(Z),l=!1,n=e.plugins.get(eh);this.listenTo(e.editing.view.document,"mousedown",(i,o)=>{let r=e.model.document.selection;if(!this.isEnabled||!n.isEnabled||!o.domEvent.shiftKey)return;let s=n.getAnchorCell()||t.getTableCellsContainingSelection(r)[0];if(!s)return;let a=this._getModelTableCellFromDomEvent(o);a&&ev(s,a)&&(l=!0,n.setCellSelection(s,a),o.preventDefault())}),this.listenTo(e.editing.view.document,"mouseup",()=>{l=!1}),this.listenTo(e.editing.view.document,"selectionChange",e=>{l&&e.stop()},{priority:"highest"})}_enableMouseDragSelection(){let e,t;let l=this.editor,n=!1,i=!1,o=l.plugins.get(eh);this.listenTo(l.editing.view.document,"mousedown",(t,l)=>{!this.isEnabled||!o.isEnabled||l.domEvent.shiftKey||l.domEvent.ctrlKey||l.domEvent.altKey||(e=this._getModelTableCellFromDomEvent(l))}),this.listenTo(l.editing.view.document,"mousemove",(l,r)=>{if(!r.domEvent.buttons||!e)return;let s=this._getModelTableCellFromDomEvent(r);s&&ev(e,s)&&(t=s,n||t==e||(n=!0)),n&&(i=!0,o.setCellSelection(e,t),r.preventDefault())}),this.listenTo(l.editing.view.document,"mouseup",()=>{n=!1,i=!1,e=null,t=null}),this.listenTo(l.editing.view.document,"selectionChange",e=>{i&&e.stop()},{priority:"highest"})}_getModelTableCellFromDomEvent(e){let t=e.target,l=this.editor.editing.view.createPositionAt(t,0);return this.editor.editing.mapper.toModelPosition(l).parent.findAncestor("tableCell",{includeSelf:!0})}}function ev(e,t){return e.parent.parent==t.parent.parent}class e_ extends n.Sy{static get requires(){return[ed,em,eh,eA,ew,eg,i.$L]}static get pluginName(){return"Table"}static get isOfficialPlugin(){return!0}}function eT(e){let t=e.getSelectedElement();return t&&eS(t)?t:null}function eR(e){let t=e.getFirstPosition();if(!t)return null;let l=t.parent;for(;l;){if(l.is("element")&&eS(l))return l;l=l.parent}return null}function eS(e){return!!e.getCustomProperty("table")&&(0,i.Qd)(e)}class ey extends n.Sy{static get requires(){return[i.e8]}static get pluginName(){return"TableToolbar"}static get isOfficialPlugin(){return!0}afterInit(){let e=this.editor,t=e.t,l=e.plugins.get(i.e8),n=e.config.get("table.contentToolbar"),o=e.config.get("table.tableToolbar");n&&l.register("tableContent",{ariaLabel:t("Table toolbar"),items:n,getRelatedElement:eR}),o&&l.register("table",{ariaLabel:t("Table toolbar"),items:o,getRelatedElement:eT})}}class ex extends n.mY{attributeName;_defaultValue;constructor(e,t,l){super(e),this.attributeName=t,this._defaultValue=l}refresh(){let e=this.editor,t=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(e.model.document.selection);this.isEnabled=!!t.length,this.value=this._getSingleValue(t)}execute(e={}){let{value:t,batch:l}=e,n=this.editor.model,i=this.editor.plugins.get("TableUtils").getSelectionAffectedTableCells(n.document.selection),o=this._getValueToSet(t);n.enqueueChange(l,e=>{o?i.forEach(t=>e.setAttribute(this.attributeName,o,t)):i.forEach(t=>e.removeAttribute(this.attributeName,t))})}_getAttribute(e){if(!e)return;let t=e.getAttribute(this.attributeName);if(t!==this._defaultValue)return t}_getValueToSet(e){if(e!==this._defaultValue)return e}_getSingleValue(e){let t=this._getAttribute(e[0]);return e.every(e=>this._getAttribute(e)===t)?t:void 0}}class eE extends ex{constructor(e,t){super(e,"tableCellWidth",t)}_getValueToSet(e){if((e=function(e,t){let l=parseFloat(e);return Number.isNaN(l)||String(l)!==String(e)?e:`${l}px`}(e,0))!==this._defaultValue)return e}}class eI extends n.Sy{static get pluginName(){return"TableCellWidthEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[ed]}init(){let e=this.editor,t=function(e,t={}){let l={borderStyle:"none",borderWidth:"",borderColor:"",backgroundColor:"",width:"",height:"",...e};return t.includeAlignmentProperty&&!l.alignment&&(l.alignment="center"),t.includePaddingProperty&&!l.padding&&(l.padding=""),t.includeVerticalAlignmentProperty&&!l.verticalAlignment&&(l.verticalAlignment="middle"),t.includeHorizontalAlignmentProperty&&!l.horizontalAlignment&&(l.horizontalAlignment=t.isRightToLeftContent?"right":"left"),l}({borderStyle:"solid",borderColor:"hsl(0, 0%, 75%)",borderWidth:"1px",...e.config.get("table.tableCellProperties.defaultProperties")},void 0);!function(e,t,l){let{modelAttribute:n}=l;e.extend("tableCell",{allowAttributes:[n]}),function(e,t){let{modelAttribute:l,styleName:n,viewElement:i,defaultValue:o,reduceBoxSides:r=!1,shouldUpcast:s=()=>!0}=t;e.for("upcast").attributeToAttribute({view:{name:i,styles:{[n]:/[\s\S]+/}},model:{key:l,value:e=>{if(!s(e))return;let t=e.getNormalizedStyle(n),l=r?function(e){if(!e)return;let t=["top","right","bottom","left"];if(!t.every(t=>e[t]))return e;let l=e.top;return t.every(t=>e[t]===l)?l:e}(t):t;if(o!==l)return l}}})}(t,{viewElement:/^(td|th)$/,...l}),function(e,t){let{modelElement:l,modelAttribute:n,styleName:i}=t;e.for("downcast").attributeToAttribute({model:{name:l,key:n},view:e=>({key:"style",value:{[i]:e}})})}(t,{modelElement:"tableCell",...l})}(e.model.schema,e.conversion,{modelAttribute:"tableCellWidth",styleName:"width",defaultValue:t.width}),e.commands.add("tableCellWidth",new eE(e,t.width))}}class eP extends n.mY{refresh(){this.isEnabled=!0}execute(e={}){let{model:t,plugins:l}=this.editor,{table:n=t.document.selection.getSelectedElement(),columnWidths:i,tableWidth:o}=e;i&&(i=Array.isArray(i)?i:i.split(",")),t.change(e=>{o?e.setAttribute("tableWidth",o,n):e.removeAttribute("tableWidth",n);let t=l.get("TableColumnResizeEditing").getColumnGroupElement(n);if(!i&&!t)return;if(!i)return e.remove(t);let r=Y(i);if(t)Array.from(t.getChildren()).forEach((t,l)=>e.setAttribute("columnWidth",r[l],t));else{let t=e.createElement("tableColumnGroup");r.forEach(l=>e.appendElement("tableColumn",{columnWidth:l},t)),e.append(t,n)}})}}class ek extends n.Sy{_isResizingActive;_resizingData;_domEmitter;_tableUtilsPlugin;static get requires(){return[ed,Z]}static get pluginName(){return"TableColumnResizeEditing"}static get isOfficialPlugin(){return!0}constructor(e){super(e),this._isResizingActive=!1,this.set("_isResizingAllowed",!0),this._resizingData=null,this._domEmitter=new((0,o.Xu)()),this._tableUtilsPlugin=e.plugins.get("TableUtils"),this.on("change:_isResizingAllowed",(t,l,n)=>{let i=n?"removeClass":"addClass";e.editing.view.change(t=>{for(let l of e.editing.view.document.roots)t[i]("ck-column-resize_disabled",e.editing.view.document.getRoot(l.rootName))})})}init(){this._extendSchema(),this._registerPostFixer(),this._registerConverters(),this._registerResizingListeners(),this._registerResizerInserter();let e=this.editor,t=e.plugins.get("TableColumnResize");e.plugins.get("TableEditing").registerAdditionalSlot({filter:e=>e.is("element","tableColumnGroup"),positionOffset:0});let l=new eP(e);e.commands.add("resizeTableWidth",l),e.commands.add("resizeColumnWidths",l),this.bind("_isResizingAllowed").to(e,"isReadOnly",t,"isEnabled",l,"isEnabled",(e,t,l)=>!e&&t&&l)}destroy(){this._domEmitter.stopListening(),super.destroy()}getColumnGroupElement(e){return q(e)}getTableColumnElements(e){return X(e)}getTableColumnsWidths(e){return X(e).map(e=>e.getAttribute("columnWidth"))}_extendSchema(){this.editor.model.schema.extend("table",{allowAttributes:["tableWidth"]}),this.editor.model.schema.register("tableColumnGroup",{allowIn:"table",isLimit:!0}),this.editor.model.schema.register("tableColumn",{allowIn:"tableColumnGroup",allowAttributes:["columnWidth","colSpan"],isLimit:!0})}_registerPostFixer(){let e=this.editor.model;e.document.registerPostFixer(t=>{let l=!1;for(let n of function(e){let t=new Set;for(let l of e.document.differ.getChanges()){let n=null;switch(l.type){case"insert":n=["table","tableRow","tableCell"].includes(l.name)?l.position:null;break;case"remove":n=["tableRow","tableCell"].includes(l.name)?l.position:null;break;case"attribute":l.range.start.nodeAfter&&(n=["table","tableRow","tableCell"].includes(l.range.start.nodeAfter.name)?l.range.start:null)}if(!n)continue;let i=n.nodeAfter&&n.nodeAfter.is("element","table")?n.nodeAfter:n.findAncestor("table");for(let l of e.createRangeOn(i).getItems())l.is("element","table")&&q(l)&&t.add(l)}return t}(e)){let e=this.getColumnGroupElement(n),i=this.getTableColumnElements(e),o=this.getTableColumnsWidths(e),r=Y(o);r=function(e,t,l){let n=l._tableUtilsPlugin.getColumns(t);if(0==n-e.length)return e;let i=e.map(e=>Number(e.replace("%","")));for(let e of function(e,t){let l=new Set;for(let n of e.getChanges())if("insert"==n.type&&n.position.nodeAfter&&"tableCell"==n.position.nodeAfter.name&&n.position.nodeAfter.getAncestors().includes(t))l.add(n.position.nodeAfter);else if("remove"==n.type){let e=n.position.nodeBefore||n.position.nodeAfter;"tableCell"==e.name&&e.getAncestors().includes(t)&&l.add(e)}return l}(l.editor.model.document.differ,t)){let o=n-i.length;if(0===o)continue;let r=o>0,s=l._tableUtilsPlugin.getCellLocation(e).column;if(r){let e=4e3/U(t,l.editor),n=Array(o).fill(e);i.splice(s,0,...n)}else{let e=i.splice(s,Math.abs(o));i[s]+=$(e)}}return i.map(e=>e+"%")}(r,n,this),(0,d.Z)(o,r)||(j(i,e,r,t),l=!0)}return l})}_registerConverters(){var e;let t=this.editor.conversion;t.for("upcast").attributeToAttribute({view:{name:"figure",key:"style",value:{width:/[\s\S]+/}},model:{name:"table",key:"tableWidth",value:e=>e.getStyle("width")}}),t.for("downcast").attributeToAttribute({model:{name:"table",key:"tableWidth"},view:e=>({name:"figure",key:"style",value:{width:e}})}),t.elementToElement({model:"tableColumnGroup",view:"colgroup"}),t.elementToElement({model:"tableColumn",view:"col"}),t.for("downcast").add(e=>e.on("insert:table",(e,t,l)=>{let n=l.writer,i=t.item,o=l.mapper.toViewElement(i),r=o.is("element","table")?o:Array.from(o.getChildren()).find(e=>e.is("element","table"));q(i)?n.addClass("ck-table-resized",r):n.removeClass("ck-table-resized",r)},{priority:"low"})),t.for("upcast").add((e=this._tableUtilsPlugin,t=>t.on("element:colgroup",(t,l,n)=>{var i;let o=l.modelCursor.findAncestor("table"),r=q(o);if(!r)return;let s=X(r),a=e.getColumns(o),d=(i=n.writer,X(r).reduce((e,t)=>{let l=t.getAttribute("columnWidth"),n=t.getAttribute("colSpan");if(!n)return e.push(l),e;for(let t=0;t<n;t++)e.push(l);return i.removeAttribute("colSpan",t),e},[]));((d=Array.from({length:a},(e,t)=>d[t]||"auto")).length!=s.length||d.includes("auto"))&&j(s,r,Y(d),n.writer)},{priority:"low"}))),t.for("upcast").attributeToAttribute({view:{name:"col",styles:{width:/.*/}},model:{key:"columnWidth",value:e=>{let t=e.getStyle("width");return t&&(t.endsWith("%")||t.endsWith("pt"))?t:"auto"}}}),t.for("upcast").attributeToAttribute({view:{name:"col",key:"span"},model:"colSpan"}),t.for("downcast").attributeToAttribute({model:{name:"tableColumn",key:"columnWidth"},view:e=>({key:"style",value:{width:e}})})}_registerResizingListeners(){let e=this.editor.editing.view;e.addObserver(eC),e.document.on("mousedown",this._onMouseDownHandler.bind(this),{priority:"high"}),this._domEmitter.listenTo(o.global.window.document,"mousemove",(0,u.Z)(this._onMouseMoveHandler.bind(this),50)),this._domEmitter.listenTo(o.global.window.document,"mouseup",this._onMouseUpHandler.bind(this))}_onMouseDownHandler(e,t){let l=t.target;if(!l.hasClass("ck-table-column-resizer")||!this._isResizingAllowed)return;let n=this.editor,i=n.editing.mapper.toModelElement(l.findAncestor("figure"));if(!n.model.canEditAt(i))return;t.preventDefault(),e.stop();let r=function(e,t,l){let n=Array(t.getColumns(e));for(let t of new f(e)){let e=l.editing.mapper.toViewElement(t.cell),i=function(e){let t=o.global.window.getComputedStyle(e);return"border-box"===t.boxSizing?parseInt(t.width):parseFloat(t.width)+parseFloat(t.paddingLeft)+parseFloat(t.paddingRight)+parseFloat(t.borderWidth)}(l.editing.view.domConverter.mapViewToDom(e));(!n[t.column]||i<n[t.column])&&(n[t.column]=K(i))}return n}(i,this._tableUtilsPlugin,n),s=l.findAncestor("table"),a=n.editing.view;Array.from(s.getChildren()).find(e=>e.is("element","colgroup"))||a.change(e=>{(function(e,t,l){let n=e.createContainerElement("colgroup");for(let l=0;l<t.length;l++){let i=e.createEmptyElement("col"),o=`${K(t[l]/$(t)*100)}%`;e.setStyle("width",o,i),e.insert(e.createPositionAt(n,"end"),i)}e.insert(e.createPositionAt(l,0),n)})(e,r,s)}),this._isResizingActive=!0,this._resizingData=this._getResizingData(t,r),a.change(e=>(function(e,t,l){let n=l.widths.viewFigureWidth/l.widths.viewFigureParentWidth;e.addClass("ck-table-resized",t),e.addClass("ck-table-column-resizer__active",l.elements.viewResizer),e.setStyle("width",`${K(100*n)}%`,t.findAncestor("figure"))})(e,s,this._resizingData))}_onMouseMoveHandler(e,t){var l,n,i;if(!this._isResizingActive)return;if(!this._isResizingAllowed){this._onMouseUpHandler();return}let{columnPosition:o,flags:{isRightEdge:r,isTableCentered:s,isLtrContent:a},elements:{viewFigure:d,viewLeftColumn:u,viewRightColumn:c},widths:{viewFigureParentWidth:m,tableWidth:h,leftColumnWidth:g,rightColumnWidth:f}}=this._resizingData,b=(l=(t.clientX-o)*((a?1:-1)*(r&&s?2:1)),n=Math.min(-g+40,0),i=Math.max(r?m-h:f-40,0),l<=n?K(n):l>=i?K(i):K(l));0!==b&&this.editor.editing.view.change(e=>{let t=K((g+b)*100/h);if(e.setStyle("width",`${t}%`,u),r){let t=K((h+b)*100/m);e.setStyle("width",`${t}%`,d)}else{let t=K((f-b)*100/h);e.setStyle("width",`${t}%`,c)}})}_onMouseUpHandler(){if(!this._isResizingActive)return;let{viewResizer:e,modelTable:t,viewFigure:l,viewColgroup:n}=this._resizingData.elements,i=this.editor,o=i.editing.view,r=this.getColumnGroupElement(t),s=Array.from(n.getChildren()).filter(e=>e.is("view:element")),a=r?this.getTableColumnsWidths(r):null,u=s.map(e=>e.getStyle("width")),c=!(0,d.Z)(a,u),m=t.getAttribute("tableWidth"),h=l.getStyle("width"),g=m!==h;(c||g)&&(this._isResizingAllowed?i.execute("resizeTableWidth",{table:t,tableWidth:`${K(h)}%`,columnWidths:u}):o.change(e=>{if(a)for(let t of s)e.setStyle("width",a.shift(),t);else e.remove(n);g&&(m?e.setStyle("width",m,l):e.removeStyle("width",l)),a||m||e.removeClass("ck-table-resized",[...l.getChildren()].find(e=>"table"===e.name))})),o.change(t=>{t.removeClass("ck-table-column-resizer__active",e)}),this._isResizingActive=!1,this._resizingData=null}_getResizingData(e,t){let l=this.editor,n=e.domEvent.clientX,i=e.target,o=i.findAncestor("td")||i.findAncestor("th"),r=l.editing.mapper.toModelElement(o),s=r.findAncestor("table"),a=function(e,t){let l=t.getCellLocation(e).column;return{leftEdge:l,rightEdge:l+(e.getAttribute("colspan")||1)-1}}(r,this._tableUtilsPlugin).rightEdge,d=a===this._tableUtilsPlugin.getColumns(s)-1,u=!s.hasAttribute("tableAlignment"),c="rtl"!==l.locale.contentLanguageDirection,m=o.findAncestor("table"),h=m.findAncestor("figure"),g=[...m.getChildren()].find(e=>e.is("element","colgroup")),f=g.getChild(a),b=d?void 0:g.getChild(a+1),p=G(l.editing.view.domConverter.mapViewToDom(h.parent)),w=G(l.editing.view.domConverter.mapViewToDom(h)),C=U(s,l),A=t[a],v=d?void 0:t[a+1];return{columnPosition:n,flags:{isRightEdge:d,isTableCentered:u,isLtrContent:c},elements:{viewResizer:i,modelTable:s,viewFigure:h,viewColgroup:g,viewLeftColumn:f,viewRightColumn:b},widths:{viewFigureParentWidth:p,viewFigureWidth:w,tableWidth:C,leftColumnWidth:A,rightColumnWidth:v}}}_registerResizerInserter(){this.editor.conversion.for("editingDowncast").add(e=>{e.on("insert:tableCell",(e,t,l)=>{let n=t.item,i=l.mapper.toViewElement(n),o=l.writer;o.insert(o.createPositionAt(i,"end"),o.createUIElement("div",{class:"ck-table-column-resizer"}))},{priority:"lowest"})})}}class ez extends n.Sy{static get requires(){return[ek,eI]}static get pluginName(){return"TableColumnResize"}static get isOfficialPlugin(){return!0}}}}]);