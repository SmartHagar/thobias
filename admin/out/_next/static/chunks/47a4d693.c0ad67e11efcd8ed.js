"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6632],{2632:function(t,e,i){i.d(e,{GU:function(){return H},aV:function(){return U}});var r=i(8937),n=i(6061),s=i(6398),l=i(2171),o=i(258),a=i(9273);i(177);class u{_startElement;_referenceIndent;_isForward;_includeSelf;_sameAttributes;_sameIndent;_lowerIndent;_higherIndent;constructor(t,e){this._startElement=t,this._referenceIndent=t.getAttribute("listIndent"),this._isForward="forward"==e.direction,this._includeSelf=!!e.includeSelf,this._sameAttributes=(0,l.qo)(e.sameAttributes||[]),this._sameIndent=!!e.sameIndent,this._lowerIndent=!!e.lowerIndent,this._higherIndent=!!e.higherIndent}static first(t,e){let i=new this(t,e)[Symbol.iterator]();return(0,l.Ps)(i)}*[Symbol.iterator](){let t=[];for(let{node:e}of d(this._getStartNode(),this._isForward?"forward":"backward")){let i=e.getAttribute("listIndent");if(i<this._referenceIndent){if(!this._lowerIndent)break;this._referenceIndent=i}else if(i>this._referenceIndent){if(!this._higherIndent)continue;if(!this._isForward){t.push(e);continue}}else{if(!this._sameIndent){if(this._higherIndent){t.length&&(yield*t,t.length=0);break}continue}if(this._sameAttributes.some(t=>e.getAttribute(t)!==this._startElement.getAttribute(t)))break}t.length&&(yield*t,t.length=0),yield e}}_getStartNode(){return this._includeSelf?this._startElement:this._isForward?this._startElement.nextSibling:this._startElement.previousSibling}}function*d(t,e="forward"){let i="forward"==e,r=[],n=null;for(;f(t);){let e=null;if(n){let i=t.getAttribute("listIndent"),s=n.getAttribute("listIndent");i>s?r[s]=n:i<s?(e=r[i],r.length=i):e=n}yield{node:t,previous:n,previousNodeInList:e},n=t,t=i?t.nextSibling:t.previousSibling}}class c{_listHead;constructor(t){this._listHead=t}[Symbol.iterator](){return d(this._listHead,"forward")}}class m{static next(){return(0,l.hQ)()}}function f(t){return!!t&&t.is("element")&&t.hasAttribute("listItemId")}function h(t,e={}){return[...p(t,{...e,direction:"backward"}),...p(t,{...e,direction:"forward"})]}function p(t,e={}){let i="forward"==e.direction,r=Array.from(new u(t,{...e,includeSelf:i,sameIndent:!0,sameAttributes:"listItemId"}));return i?r:r.reverse()}function g(t,e){let i=new u(t,{sameIndent:!0,sameAttributes:"listType",...e}),r=new u(t,{sameIndent:!0,sameAttributes:"listType",includeSelf:!0,direction:"forward",...e});return[...Array.from(i).reverse(),...r]}function b(t){return!u.first(t,{sameIndent:!0,sameAttributes:"listItemId"})}function I(t){return!u.first(t,{direction:"forward",sameIndent:!0,sameAttributes:"listItemId"})}function A(t,e={}){t=(0,l.qo)(t);let i=!1!==e.withNested,r=new Set;for(let e of t)for(let t of h(e,{higherIndent:i}))r.add(t);return x(r)}function y(t,e){let i=p(t,{direction:"forward"}),r=m.next();for(let t of i)e.setAttribute("listItemId",r,t);return i}function w(t,e,i){let r={};for(let[t,i]of e.getAttributes())t.startsWith("list")&&(r[t]=i);let n=p(t,{direction:"forward"});for(let t of n)i.setAttributes(r,t);return n}function _(t,e,{expand:i,indentBy:r=1}={}){t=(0,l.qo)(t);let n=i?A(t):t;for(let t of n){let i=t.getAttribute("listIndent")+r;i<0?E(t,e):e.setAttribute("listIndent",i,t)}return n}function E(t,e){for(let i of t=(0,l.qo)(t))i.is("element","listItem")&&e.rename(i,"paragraph");for(let i of t)for(let t of i.getAttributeKeys())t.startsWith("list")&&e.removeAttribute(t,i);return t}function k(t){if(!t.length)return!1;let e=t[0].getAttribute("listItemId");return!!e&&!t.some(t=>t.getAttribute("listItemId")!=e)}function x(t){return Array.from(t).filter(t=>"$graveyard"!==t.root.rootName).sort((t,e)=>t.index-e.index)}function S(t){let e=t.document.selection.getSelectedElement();return e&&t.schema.isObject(e)&&t.schema.isBlock(e)?e:null}function v(t,e){return e.checkChild(t.parent,"listItem")&&e.checkChild(t,"$text")&&!e.isObject(t)}class T extends r.mY{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute(){let t=this.editor.model,e=L(t.document.selection);t.change(t=>{let i=[];for(let r of(k(e)&&!b(e[0])?("forward"==this._direction&&i.push(..._(e,t)),i.push(...y(e[0],t))):"forward"==this._direction?i.push(..._(e,t,{expand:!0})):i.push(...function(t,e){let i=A(t=(0,l.qo)(t)),r=new Set,n=Math.min(...i.map(t=>t.getAttribute("listIndent"))),s=new Map;for(let t of i)s.set(t,u.first(t,{lowerIndent:!0}));for(let t of i){if(r.has(t))continue;r.add(t);let i=t.getAttribute("listIndent")-1;if(i<0){E(t,e);continue}if(t.getAttribute("listIndent")==n){var o;let i=p(o=s.get(t),{direction:"forward"}).pop().index>t.index?w(t,o,e):[];for(let t of i)r.add(t);if(i.length)continue}e.setAttribute("listIndent",i,t)}return x(r)}(e,t)),i)){if(!r.hasAttribute("listType"))continue;let e=u.first(r,{sameIndent:!0});e&&t.setAttribute("listType",e.getAttribute("listType"),r)}this._fireAfterExecute(i)})}_fireAfterExecute(t){this.fire("afterExecute",x(new Set(t)))}_checkEnabled(){let t=L(this.editor.model.document.selection),e=t[0];if(!e)return!1;if("backward"==this._direction||k(t)&&!b(t[0]))return!0;e=(t=A(t))[0];let i=u.first(e,{sameIndent:!0});return!!i&&i.getAttribute("listType")==e.getAttribute("listType")}}function L(t){let e=Array.from(t.getSelectedBlocks()),i=e.findIndex(t=>!f(t));return -1!=i&&(e.length=i),e}class P extends r.mY{type;_listWalkerOptions;constructor(t,e,i={}){super(t),this.type=e,this._listWalkerOptions=i.multiLevel?{higherIndent:!0,lowerIndent:!0,sameAttributes:[]}:void 0}refresh(){this.value=this._getValue(),this.isEnabled=this._checkEnabled()}execute(t={}){let e=this.editor.model,i=e.document,r=S(e),n=Array.from(i.selection.getSelectedBlocks()).filter(t=>e.schema.checkAttribute(t,"listType")||v(t,e.schema)),s=void 0!==t.forceValue?!t.forceValue:this.value;e.change(l=>{if(s){let t=n[n.length-1],e=p(t,{direction:"forward"}),i=[];e.length>1&&i.push(...y(e[1],l)),i.push(...E(n,l)),i.push(...function(t,e){let i=[],r=Number.POSITIVE_INFINITY;for(let{node:n}of d(t.nextSibling,"forward")){let t=n.getAttribute("listIndent");if(0==t)break;t<r&&(r=t);let s=t-r;e.setAttribute("listIndent",s,n),i.push(n)}return i}(t,l)),this._fireAfterExecute(i)}else if((r||i.selection.isCollapsed)&&f(n[0])){let e=g(r||n[0],this._listWalkerOptions);for(let i of e)l.setAttributes({...t.additionalAttributes,listType:this.type},i);this._fireAfterExecute(e)}else{let i=[];for(let r of n)if(r.hasAttribute("listType"))for(let e of A(r,{withNested:!1}))e.getAttribute("listType")!=this.type&&(l.setAttributes({...t.additionalAttributes,listType:this.type},e),i.push(e));else!r.is("element","listItem")&&v(r,e.schema)&&l.rename(r,"listItem"),l.setAttributes({...t.additionalAttributes,listIndent:0,listItemId:m.next(),listType:this.type},r),i.push(r);this._fireAfterExecute(i)}})}_fireAfterExecute(t){this.fire("afterExecute",x(new Set(t)))}_getValue(){let t=Array.from(this.editor.model.document.selection.getSelectedBlocks());if(!t.length)return!1;for(let e of t)if(e.getAttribute("listType")!=this.type)return!1;return!0}_checkEnabled(){let t=this.editor.model,e=t.schema,i=Array.from(t.document.selection.getSelectedBlocks());if(!i.length)return!1;if(this.value)return!0;for(let t of i)if(e.checkAttribute(t,"listType")||v(t,e))return!0;return!1}}class C extends r.mY{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute({shouldMergeOnBlocksContentLevel:t=!1}={}){let e=this.editor.model,i=e.document.selection,r=[];e.change(n=>{let{firstElement:s,lastElement:l}=this._getMergeSubjectElements(i,t),o=s.getAttribute("listIndent")||0,a=l.getAttribute("listIndent"),d=l.getAttribute("listItemId");if(o!=a){let t=Array.from(new u(l,{direction:"forward",higherIndent:!0}));r.push(..._([l,...t],n,{indentBy:o-a,expand:o<a}))}if(t){let t=i;i.isCollapsed&&(t=n.createSelection(n.createRange(n.createPositionAt(s,"end"),n.createPositionAt(l,0)))),e.deleteContent(t,{doNotResetEntireContent:i.isCollapsed});let o=t.getLastPosition().parent,a=o.nextSibling;r.push(o),a&&a!==l&&a.getAttribute("listItemId")==d&&r.push(...w(a,o,n))}else r.push(...w(l,s,n));this._fireAfterExecute(r)})}_fireAfterExecute(t){this.fire("afterExecute",x(new Set(t)))}_checkEnabled(){let t=this.editor.model,e=t.document.selection,i=S(t);if(e.isCollapsed||i){let t=i||e.getFirstPosition().parent;if(!f(t))return!1;let r="backward"==this._direction?t.previousSibling:t.nextSibling;if(!r||k([t,r]))return!1}else{let t=e.getLastPosition(),i=e.getFirstPosition();if(t.parent===i.parent||!f(t.parent))return!1}return!0}_getMergeSubjectElements(t,e){let i,r;let n=S(this.editor.model);if(t.isCollapsed||n){let s=n||t.getFirstPosition().parent,l=b(s);"backward"==this._direction?(r=s,i=l&&!e?u.first(s,{sameIndent:!0,lowerIndent:!0}):s.previousSibling):(i=s,r=s.nextSibling)}else i=t.getFirstPosition().parent,r=t.getLastPosition().parent;return{firstElement:i,lastElement:r}}}class B extends r.mY{_direction;constructor(t,e){super(t),this._direction=e}refresh(){this.isEnabled=this._checkEnabled()}execute(){this.editor.model.change(t=>{let e=y(this._getStartBlock(),t);this._fireAfterExecute(e)})}_fireAfterExecute(t){this.fire("afterExecute",x(new Set(t)))}_checkEnabled(){let t=this.editor.model.document.selection,e=this._getStartBlock();return t.isCollapsed&&f(e)&&!b(e)}_getStartBlock(){let t=this.editor.model.document.selection.getFirstPosition().parent;return"before"==this._direction?t:t.nextSibling}}class N extends r.Sy{static get pluginName(){return"ListUtils"}static get isOfficialPlugin(){return!0}expandListBlocksToCompleteList(t){return function(t){t=(0,l.qo)(t);let e=new Set;for(let i of t)for(let t of g(i))e.add(t);return x(e)}(t)}isFirstBlockOfListItem(t){return b(t)}isListItemBlock(t){return f(t)}expandListBlocksToCompleteItems(t,e={}){return A(t,e)}isNumberedListType(t){return"numbered"==t||"customNumbered"==t}}function F(t){return t.is("element","li")}function O(t){return"numbered"==t||"customNumbered"==t?"ol":"ul"}function M(t,e){return`list-${t}-${e}`}function $(t,e){let i=t.nodeBefore;if(f(i)){let t=i;for(let{node:i}of d(t,"backward"))if(t=i,e.has(t))return;e.set(i,t)}else{let i=t.nodeAfter;f(i)&&e.set(i,i)}}function R(t,e,i,{dataPipeline:r}={}){let n=(e,i)=>{let r=[];for(let i of t)e.hasAttribute(i)&&r.push(`attribute:${i}`);return!!r.every(t=>!1!==i.test(e,t))&&(r.forEach(t=>i.consume(e,t)),!0)};return(s,l,o)=>{let{writer:a,mapper:d,consumable:c}=o,m=l.item;if(!t.includes(l.attributeKey)||!n(m,c))return;let f=function(t,e,i){let r=i.createRangeOn(t);return e.toViewRange(r).getTrimmed().end.nodeBefore}(m,d,i);W(f,a,d),function(t,e){let i=t.parent;for(;i.is("attributeElement")&&["ul","ol","li"].includes(i.name);){let r=i.parent;e.unwrap(e.createRangeOn(t),i),i=r}}(f,a);let h=function(t,e,i,r,{dataPipeline:n}){let s=r.createRangeOn(e);if(!b(t))return s;for(let l of i){if("itemMarker"!=l.scope)continue;let i=l.createElement(r,t,{dataPipeline:n});if(!i||(r.setCustomProperty("listItemMarker",!0,i),l.canInjectMarkerIntoElement&&l.canInjectMarkerIntoElement(t)?r.insert(r.createPositionAt(e,0),i):(r.insert(s.start,i),s=r.createRange(r.createPositionBefore(i),r.createPositionAfter(e))),!l.createWrapperElement||!l.canWrapElement))continue;let o=l.createWrapperElement(r,t,{dataPipeline:n});r.setCustomProperty("listItemWrapper",!0,o),l.canWrapElement(t)?s=r.wrap(s,o):(s=r.wrap(r.createRangeOn(i),o),s=r.createRange(s.start,r.createPositionAfter(e)))}return s}(m,f,e,a,{dataPipeline:r});!function(t,e,i,r){if(!t.hasAttribute("listIndent"))return;let n=t.getAttribute("listIndent"),s=t;for(let t=n;t>=0;t--){var l,o;let n=(l=t,o=s.getAttribute("listItemId"),r.createAttributeElement("li",null,{priority:(2*l+1)/100-100,id:o})),a=function(t,e,i,r=M(i,e)){return t.createAttributeElement(O(i),null,{priority:2*e/100-100,id:r})}(r,t,s.getAttribute("listType"));for(let t of i)("list"==t.scope||"item"==t.scope)&&s.hasAttribute(t.attributeName)&&t.setAttributeOnDowncast(r,s.getAttribute(t.attributeName),"list"==t.scope?a:n);if(e=r.wrap(e,n),e=r.wrap(e,a),0==t||!(s=u.first(s,{lowerIndent:!0})))break}}(m,h,e,a)}}function V(t,{dataPipeline:e}={}){return(i,{writer:r})=>{if(!D(i,t))return null;if(!e)return r.createContainerElement("span",{class:"ck-list-bogus-paragraph"});let n=r.createContainerElement("p");return r.setCustomProperty("dataPipeline:transparentRendering",!0,n),n}}function W(t,e,i){for(;t.parent.is("attributeElement")&&t.parent.getCustomProperty("listItemWrapper");)e.unwrap(e.createRangeOn(t),t.parent);let r=[];for(let i of(n(e.createPositionBefore(t).getWalker({direction:"backward"})),n(e.createRangeIn(t).getWalker()),r))e.remove(i);function n(t){for(let{item:e}of t){if(e.is("element")&&i.toModelElement(e))break;e.is("element")&&e.getCustomProperty("listItemMarker")&&r.push(e)}}}function D(t,e,i=h(t)){if(!f(t))return!1;for(let i of t.getAttributeKeys())if(!i.startsWith("selection:")&&!e.includes(i))return!1;return i.length<2}let j=["listType","listIndent","listItemId"];class q extends r.Sy{_downcastStrategies=[];static get pluginName(){return"ListEditing"}static get isOfficialPlugin(){return!0}static get requires(){return[s.C,n.HG,N,o._l]}constructor(t){super(t),t.config.define("list.multiBlock",!0)}init(){let t=this.editor,e=t.model,i=t.config.get("list.multiBlock");if(t.plugins.has("LegacyListEditing"))throw new l.Bb("list-feature-conflict",this,{conflictPlugin:"LegacyListEditing"});for(let t of(e.schema.register("$listItem",{allowAttributes:j}),i?(e.schema.extend("$container",{allowAttributesOf:"$listItem"}),e.schema.extend("$block",{allowAttributesOf:"$listItem"}),e.schema.extend("$blockObject",{allowAttributesOf:"$listItem"})):e.schema.register("listItem",{inheritAllFrom:"$block",allowAttributesOf:"$listItem"}),j))e.schema.setAttributeProperties(t,{copyOnReplace:!0});t.commands.add("numberedList",new P(t,"numbered")),t.commands.add("bulletedList",new P(t,"bulleted")),t.commands.add("customNumberedList",new P(t,"customNumbered",{multiLevel:!0})),t.commands.add("customBulletedList",new P(t,"customBulleted",{multiLevel:!0})),t.commands.add("indentList",new T(t,"forward")),t.commands.add("outdentList",new T(t,"backward")),t.commands.add("splitListItemBefore",new B(t,"before")),t.commands.add("splitListItemAfter",new B(t,"after")),i&&(t.commands.add("mergeListItemBackward",new C(t,"backward")),t.commands.add("mergeListItemForward",new C(t,"forward"))),this._setupDeleteIntegration(),this._setupEnterIntegration(),this._setupTabIntegration(),this._setupClipboardIntegration(),this._setupAccessibilityIntegration()}afterInit(){let t=this.editor.commands,e=t.get("indent"),i=t.get("outdent");e&&e.registerChildCommand(t.get("indentList"),{priority:"high"}),i&&i.registerChildCommand(t.get("outdentList"),{priority:"lowest"}),this._setupModelPostFixing(),this._setupConversion()}registerDowncastStrategy(t){this._downcastStrategies.push(t)}getListAttributeNames(){return[...j,...this._downcastStrategies.map(t=>t.attributeName)]}_setupDeleteIntegration(){let t=this.editor,e=t.commands.get("mergeListItemBackward"),i=t.commands.get("mergeListItemForward");this.listenTo(t.editing.view.document,"delete",(r,n)=>{let s=t.model.document.selection;S(t.model)||t.model.change(()=>{let l=s.getFirstPosition();if(s.isCollapsed&&"backward"==n.direction){if(!l.isAtStart)return;let i=l.parent;if(!f(i))return;if(u.first(i,{sameAttributes:"listType",sameIndent:!0})||0!==i.getAttribute("listIndent")){if(!e||!e.isEnabled)return;e.execute({shouldMergeOnBlocksContentLevel:K(t.model,"backward")})}else I(i)||t.execute("splitListItemAfter"),t.execute("outdentList");n.preventDefault(),r.stop()}else{if(s.isCollapsed&&!s.getLastPosition().isAtEnd||!i||!i.isEnabled)return;i.execute({shouldMergeOnBlocksContentLevel:K(t.model,"forward")}),n.preventDefault(),r.stop()}})},{context:"li"})}_setupEnterIntegration(){let t=this.editor,e=t.model,i=t.commands,r=i.get("enter");this.listenTo(t.editing.view.document,"enter",(i,r)=>{let n=e.document,s=n.selection.getFirstPosition().parent;if(n.selection.isCollapsed&&f(s)&&s.isEmpty&&!r.isSoft){let e=b(s),n=I(s);e&&n?(t.execute("outdentList"),r.preventDefault(),i.stop()):e&&!n?(t.execute("splitListItemAfter"),r.preventDefault(),i.stop()):n&&(t.execute("splitListItemBefore"),r.preventDefault(),i.stop())}},{context:"li"}),this.listenTo(r,"afterExecute",()=>{let e=i.get("splitListItemBefore");e.refresh(),e.isEnabled&&2===h(t.model.document.selection.getLastPosition().parent).length&&e.execute()})}_setupTabIntegration(){let t=this.editor;this.listenTo(t.editing.view.document,"tab",(e,i)=>{let r=i.shiftKey?"outdentList":"indentList";this.editor.commands.get(r).isEnabled&&(t.execute(r),i.stopPropagation(),i.preventDefault(),e.stop())},{context:"li"})}_setupConversion(){var t,e;let i=this.editor,r=i.model,n=this.getListAttributeNames(),s=i.config.get("list.multiBlock"),l=s?"paragraph":"listItem";i.conversion.for("upcast").elementToElement({view:"li",model:(t,{writer:e})=>e.createElement(l,{listType:""})}).elementToElement({view:"p",model:(t,{writer:e})=>t.parent&&t.parent.is("element","li")?e.createElement(l,{listType:""}):null,converterPriority:"high"}).add(t=>{t.on("element:li",(t,e,i)=>{let{writer:r,schema:n}=i;if(!e.modelRange)return;let s=Array.from(e.modelRange.getItems({shallow:!0})).filter(t=>n.checkAttribute(t,"listItemId"));if(!s.length)return;let l=m.next(),o=function(t){let e=0,i=t.parent;for(;i;){if(F(i))e++;else{let t=i.previousSibling;t&&F(t)&&e++}i=i.parent}return e}(e.viewItem),a=e.viewItem.parent&&e.viewItem.parent.is("element","ol")?"numbered":"bulleted",u=s[0].getAttribute("listType");u&&(a=u);let d={listItemId:l,listIndent:o,listType:a};for(let t of s)t.hasAttribute("listItemId")||r.setAttributes(d,t);s.length>1&&s[1].getAttribute("listItemId")!=d.listItemId&&i.keepEmptyElement(s[0])})}),s||i.conversion.for("downcast").elementToElement({model:"listItem",view:"p"}),i.conversion.for("editingDowncast").elementToElement({model:l,view:V(n),converterPriority:"high"}).add(t=>{var e;t.on("attribute",R(n,this._downcastStrategies,r)),t.on("remove",(e=r.schema,(t,i,r)=>{let{writer:n,mapper:s}=r,l=t.name.split(":")[1];if(!e.checkAttribute(l,"listItemId"))return;let o=s.toViewPosition(i.position),a=i.position.getShiftedBy(i.length),u=s.toViewPosition(a,{isPhantom:!0}),d=n.createRange(o,u).getTrimmed().end.nodeBefore;d&&W(d,n,s)}))}),i.conversion.for("dataDowncast").elementToElement({model:l,view:V(n,{dataPipeline:!0}),converterPriority:"high"}).add(t=>{t.on("attribute",R(n,this._downcastStrategies,r,{dataPipeline:!0}))});let o=(t=this._downcastStrategies,e=i.editing.view,(i,r)=>{if(r.modelPosition.offset>0)return;let n=r.modelPosition.parent;if(!f(n)||!t.some(t=>"itemMarker"==t.scope&&t.canInjectMarkerIntoElement&&t.canInjectMarkerIntoElement(n)))return;let s=r.mapper.toViewElement(n),l=e.createRangeIn(s),o=l.getWalker(),a=l.start;for(let{item:t}of o){if(t.is("element")&&r.mapper.toModelElement(t)||t.is("$textProxy"))break;t.is("element")&&t.getCustomProperty("listItemMarker")&&(a=e.createPositionAfter(t),o.skip(({previousPosition:t})=>!t.isEqual(a)))}r.viewPosition=a});i.editing.mapper.on("modelToViewPosition",o),i.data.mapper.on("modelToViewPosition",o),this.listenTo(r.document,"change:data",function(t,e,i,r){return()=>{let s=t.document.differ.getChanges(),l=[],o=new Map,a=new Set;for(let t of s)if("insert"==t.type&&"$text"!=t.name)$(t.position,o),t.attributes.has("listItemId")?a.add(t.position.nodeAfter):$(t.position.getShiftedBy(t.length),o);else if("remove"==t.type&&t.attributes.has("listItemId"))$(t.position,o);else if("attribute"==t.type){let e=t.range.start.nodeAfter;i.includes(t.attributeKey)?($(t.range.start,o),null===t.attributeNewValue?($(t.range.start.getShiftedBy(1),o),n(e)&&l.push(e)):a.add(e)):f(e)&&n(e)&&l.push(e)}for(let t of o.values())l.push(...function(t,s){let l=[],o=new Set,a=[];for(let{node:u,previous:c}of d(t,"forward")){if(o.has(u))continue;let t=u.getAttribute("listIndent");c&&t<c.getAttribute("listIndent")&&(a.length=t+1),a[t]=Object.fromEntries(Array.from(u.getAttributes()).filter(([t])=>i.includes(t)));let d=p(u,{direction:"forward"});for(let t of d)o.add(t),n(t,d)?l.push(t):function(t,i,n){if(n.has(t))return!1;let s=e.mapper.toViewElement(t),l=i.length-1;for(let t=s.parent;!t.is("editableElement");t=t.parent){var o;let e=F(t),n=(o=t).is("element","ol")||o.is("element","ul");if(!n&&!e)continue;let s=`checkAttributes:${e?"item":"list"}`;if(r.fire(s,{viewElement:t,modelAttributes:i[l]}))break;if(n&&--l<0)return!1}return!0}(t,a,s)&&l.push(t)}return l}(t,a));for(let t of new Set(l))e.reconvertItem(t)};function n(t,n){let s=e.mapper.toViewElement(t);if(!s)return!1;if(r.fire("checkElement",{modelElement:t,viewElement:s}))return!0;if(!t.is("element","paragraph")&&!t.is("element","listItem"))return!1;let l=D(t,i,n);return!!(l&&s.is("element","p"))||!!(!l&&s.is("element","span"))}}(r,i.editing,n,this),{priority:"high"}),this.on("checkAttributes:item",(t,{viewElement:e,modelAttributes:i})=>{e.id!=i.listItemId&&(t.return=!0,t.stop())}),this.on("checkAttributes:list",(t,{viewElement:e,modelAttributes:i})=>{(e.name!=O(i.listType)||e.id!=M(i.listType,i.listIndent))&&(t.return=!0,t.stop())})}_setupModelPostFixing(){let t=this.editor.model,e=this.getListAttributeNames();t.document.registerPostFixer(i=>(function(t,e,i,r){let n=t.document.differ.getChanges(),s=new Map,l=r.editor.config.get("list.multiBlock"),o=!1;for(let r of n){if("insert"==r.type&&"$text"!=r.name){let n=r.position.nodeAfter;if(!t.schema.checkAttribute(n,"listItemId"))for(let t of Array.from(n.getAttributeKeys()))i.includes(t)&&(e.removeAttribute(t,n),o=!0);for(let{item:e,previousPosition:i}of($(r.position,s),r.attributes.has("listItemId")||$(r.position.getShiftedBy(r.length),s),t.createRangeIn(n)))f(e)&&$(i,s)}else"remove"==r.type?$(r.position,s):"attribute"==r.type&&i.includes(r.attributeKey)&&($(r.range.start,s),null===r.attributeNewValue&&$(r.range.start.getShiftedBy(1),s));if(!l&&"attribute"==r.type&&j.includes(r.attributeKey)){let t=r.range.start.nodeAfter;null===r.attributeNewValue&&t&&t.is("element","listItem")?(e.rename(t,"paragraph"),o=!0):null===r.attributeOldValue&&t&&t.is("element")&&"listItem"!=t.name&&(e.rename(t,"listItem"),o=!0)}}let a=new Set;for(let t of s.values())o=r.fire("postFixer",{listNodes:new c(t),listHead:t,writer:e,seenIds:a})||o;return o})(t,i,e,this)),this.on("postFixer",(t,{listNodes:e,writer:i})=>{t.return=function(t,e){let i=0,r=-1,n=null,s=!1;for(let{node:l}of t){let t=l.getAttribute("listIndent");if(t>i){let o;null===n?(n=t-i,o=i):(n>t&&(n=t),o=t-n),o>r+1&&(o=r+1),e.setAttribute("listIndent",o,l),s=!0,r=o}else n=null,i=t+1,r=t}return s}(e,i)||t.return},{priority:"high"}),this.on("postFixer",(t,{listNodes:e,writer:i,seenIds:r})=>{t.return=function(t,e,i){let r=new Set,n=!1;for(let{node:s}of t){if(r.has(s))continue;let t=s.getAttribute("listType"),l=s.getAttribute("listItemId");if(e.has(l)&&(l=m.next()),e.add(l),s.is("element","listItem")){s.getAttribute("listItemId")!=l&&(i.setAttribute("listItemId",l,s),n=!0);continue}for(let e of p(s,{direction:"forward"}))r.add(e),e.getAttribute("listType")!=t&&(l=m.next(),t=e.getAttribute("listType")),e.getAttribute("listItemId")!=l&&(i.setAttribute("listItemId",l,e),n=!0)}return n}(e,r,i)||t.return},{priority:"high"})}_setupClipboardIntegration(){let t=this.editor.model,e=this.editor.plugins.get("ClipboardPipeline");this.listenTo(t,"insertContent",(e,[i,r])=>{let n;let s=i.is("documentFragment")?Array.from(i.getChildren()):[i];if(!s.length)return;let l=(r?t.createSelection(r):t.document.selection).getFirstPosition();if(f(l.parent))n=l.parent;else{if(!f(l.nodeBefore))return;n=l.nodeBefore}t.change(t=>{let e=n.getAttribute("listType"),i=Math.max(n.getAttribute("listIndent")-(s[0].getAttribute("listIndent")||0),0);for(let r of s){let s=f(r);n.is("element","listItem")&&r.is("element","paragraph")&&t.rename(r,"listItem"),t.setAttributes({listIndent:(s?r.getAttribute("listIndent"):0)+i,listItemId:s?r.getAttribute("listItemId"):m.next(),listType:e},r)}})},{priority:"high"}),this.listenTo(e,"outputTransformation",(e,i)=>{t.change(t=>{let e=Array.from(i.content.getChildren()),r=e[e.length-1];if(e.length>1&&r.is("element")&&r.isEmpty&&e.slice(0,-1).every(f)&&t.remove(r),"copy"==i.method||"cut"==i.method){let e=Array.from(i.content.getChildren());k(e)&&E(e,t)}})})}_setupAccessibilityIntegration(){let t=this.editor,e=t.t;t.accessibility.addKeystrokeInfoGroup({id:"list",label:e("Keystrokes that can be used in a list"),keystrokes:[{label:e("Increase list item indent"),keystroke:"Tab"},{label:e("Decrease list item indent"),keystroke:"Shift+Tab"}]})}}function K(t,e){let i=t.document.selection;if(!i.isCollapsed)return!S(t);if("forward"===e)return!0;let r=i.getFirstPosition().parent,n=r.previousSibling;return!t.schema.isObject(n)&&(!!n.isEmpty||k([r,n]))}function Y(t,e,i,r){t.ui.componentFactory.add(e,()=>{let n=G(a.r5,t,e,i,r);return n.set({tooltip:!0,isToggleable:!0}),n}),t.ui.componentFactory.add(`menuBar:${e}`,()=>{let n=G(a.DE,t,e,i,r);return n.set({role:"menuitemcheckbox",isToggleable:!0}),n})}function G(t,e,i,r,n){let s=e.commands.get(i),l=new t(e.locale);return l.set({label:r,icon:n}),l.bind("isOn","isEnabled").to(s,"value","isEnabled"),l.on("execute",()=>{e.execute(i),e.editing.view.focus()}),l}class H extends r.Sy{static get pluginName(){return"ListUI"}static get isOfficialPlugin(){return!0}init(){let t=this.editor.t;this.editor.ui.componentFactory.has("numberedList")||Y(this.editor,"numberedList",t("Numbered List"),r.ci.numberedList),this.editor.ui.componentFactory.has("bulletedList")||Y(this.editor,"bulletedList",t("Bulleted List"),r.ci.bulletedList)}}class U extends r.Sy{static get requires(){return[q,H]}static get pluginName(){return"List"}static get isOfficialPlugin(){return!0}}let z={},Q={},J={};for(let{listStyle:t,typeAttribute:e,listType:i}of[{listStyle:"disc",typeAttribute:"disc",listType:"bulleted"},{listStyle:"circle",typeAttribute:"circle",listType:"bulleted"},{listStyle:"square",typeAttribute:"square",listType:"bulleted"},{listStyle:"decimal",typeAttribute:"1",listType:"numbered"},{listStyle:"decimal-leading-zero",typeAttribute:null,listType:"numbered"},{listStyle:"lower-roman",typeAttribute:"i",listType:"numbered"},{listStyle:"upper-roman",typeAttribute:"I",listType:"numbered"},{listStyle:"lower-alpha",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-alpha",typeAttribute:"A",listType:"numbered"},{listStyle:"lower-latin",typeAttribute:"a",listType:"numbered"},{listStyle:"upper-latin",typeAttribute:"A",listType:"numbered"}])z[t]=i,Q[t]=e,e&&(J[e]=t);a.G7}}]);